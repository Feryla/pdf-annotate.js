{"version":3,"file":"pdf-annotate.min.js","sources":["../src/utils/abstractFunction.js","../__vite-browser-external","../src/UI/utils.js","../src/UI/event.js","../src/adapter/StoreAdapter.js","../src/utils/uuid.js","../src/adapter/LocalStoreAdapter.js","../src/utils/setAttributes.js","../src/utils/normalizeColor.js","../src/render/renderLine.js","../src/render/renderPath.js","../src/render/renderPoint.js","../src/render/renderRect.js","../src/render/renderText.js","../src/render/appendChild.js","../src/a11y/createScreenReaderOnly.js","../src/a11y/insertElementWithinElement.js","../src/a11y/insertElementWithinChildren.js","../src/a11y/insertScreenReaderComment.js","../src/a11y/renderScreenReaderComments.js","../src/a11y/insertScreenReaderHint.js","../src/a11y/initEventHandlers.js","../src/a11y/renderScreenReaderHints.js","../src/render/index.js","../src/UI/edit.js","../src/UI/pen.js","../src/UI/point.js","../src/UI/rect.js","../src/UI/text.js","../src/UI/page.js","../src/UI/index.js","../src/PDFJSAnnotate.js"],"sourcesContent":["/**\n * Throw an Error for an abstract function that hasn't been implemented.\n *\n * @param {String} name The name of the abstract function\n */\nexport default function abstractFunction(name) {\n  throw new Error(name + ' is not implemented');\n}\n","export default {}","export const BORDER_COLOR = '#00BFFF';\n\n// Create a stylesheet for user selection control\nconst userSelectStyleSheet = document.createElement('style');\nuserSelectStyleSheet.textContent = `\n  body {\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n  }\n`;\nuserSelectStyleSheet.setAttribute('data-pdf-annotate-user-select', 'true');\n\n/**\n * Find the SVGElement that contains all the annotations for a page\n *\n * @param {Element} node An annotation within that container\n * @return {SVGElement} The container SVG or null if it can't be found\n */\nexport function findSVGContainer(node) {\n  let parentNode = node;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    if (parentNode.nodeName.toUpperCase() === 'SVG' &&\n        parentNode.getAttribute('data-pdf-annotate-container') === 'true') {\n      return parentNode;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find an SVGElement container at a given point\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @return {SVGElement} The container SVG or null if one can't be found\n */\nexport function findSVGAtPoint(x, y) {\n  let elements = document.querySelectorAll('svg[data-pdf-annotate-container=\"true\"]');\n\n  for (let i=0, l=elements.length; i<l; i++) {\n    let el = elements[i];\n    let rect = el.getBoundingClientRect();\n\n    if (pointIntersectsRect(x, y, rect)) {\n\n      return el;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find an Element that represents an annotation at a given point\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @return {Element} The annotation element or null if one can't be found\n */\nexport function findAnnotationAtPoint(x, y) {\n  let svg = findSVGAtPoint(x, y);\n  if (!svg) { return; }\n  let elements = svg.querySelectorAll('[data-pdf-annotate-type]');\n\n  // Find a target element within SVG\n  for (let i=0, l=elements.length; i<l; i++) {\n    let el = elements[i];\n    if (pointIntersectsRect(x, y, getOffsetAnnotationRect(el))) {   \n      return el;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Determine if a point intersects a rect\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Object} rect The points of a rect (likely from getBoundingClientRect)\n * @return {Boolean} True if a collision occurs, otherwise false\n */\nexport function pointIntersectsRect(x, y, rect) {\n  return y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\n}\n\n/**\n * Get the rect of an annotation element accounting for offset.\n *\n * @param {Element} el The element to get the rect of\n * @return {Object} The dimensions of the element\n */\nexport function getOffsetAnnotationRect(el) {\n  let rect = getAnnotationRect(el);\n  let { offsetLeft, offsetTop } = getOffset(el);\n  return {\n    top: rect.top + offsetTop,\n    left: rect.left + offsetLeft,\n    right: rect.right + offsetLeft,\n    bottom: rect.bottom + offsetTop\n  };\n}\n\n/**\n * Get the rect of an annotation element.\n *\n * @param {Element} el The element to get the rect of\n * @return {Object} The dimensions of the element\n */\nexport function getAnnotationRect(el) {\n  let h = 0, w = 0, x = 0, y = 0;\n  let rect = el.getBoundingClientRect();\n  // TODO this should be calculated somehow\n  const LINE_OFFSET = 16;\n\n  switch (el.nodeName.toLowerCase()) {\n    case 'path':\n    let minX, maxX, minY, maxY;\n\n    el.getAttribute('d').replace(/Z/, '').split('M').splice(1).forEach((p) => {\n      var s = p.split(' ').map(i => parseInt(i, 10));\n\n      if (typeof minX === 'undefined' || s[0] < minX) { minX = s[0]; }\n      if (typeof maxX === 'undefined' || s[2] > maxX) { maxX = s[2]; }\n      if (typeof minY === 'undefined' || s[1] < minY) { minY = s[1]; }\n      if (typeof maxY === 'undefined' || s[3] > maxY) { maxY = s[3]; }\n    });\n\n    h = maxY - minY;\n    w = maxX - minX;\n    x = minX;\n    y = minY;\n    break;\n\n    case 'line':\n    h = parseInt(el.getAttribute('y2'), 10) - parseInt(el.getAttribute('y1'), 10);\n    w = parseInt(el.getAttribute('x2'), 10) - parseInt(el.getAttribute('x1'), 10);\n    x = parseInt(el.getAttribute('x1'), 10);\n    y = parseInt(el.getAttribute('y1'), 10);\n\n    if (h === 0) {\n      h += LINE_OFFSET;\n      y -= (LINE_OFFSET / 2);\n    }\n    break;\n\n    case 'text':\n    h = rect.height;\n    w = rect.width;\n    x = parseInt(el.getAttribute('x'), 10);\n    y = parseInt(el.getAttribute('y'), 10) - h;\n    break;\n\n    case 'g':\n    let { offsetLeft, offsetTop } = getOffset(el);\n    h = rect.height;\n    w = rect.width;\n    x = rect.left - offsetLeft;\n    y = rect.top - offsetTop;\n\n    if (el.getAttribute('data-pdf-annotate-type') === 'strikeout') {\n      h += LINE_OFFSET;\n      y -= (LINE_OFFSET / 2);\n    }\n    break;\n\n    case 'rect':\n    case 'svg':\n    h = parseInt(el.getAttribute('height'), 10);\n    w = parseInt(el.getAttribute('width'), 10);\n    x = parseInt(el.getAttribute('x'), 10);\n    y = parseInt(el.getAttribute('y'), 10);\n    break;\n  }\n\n  // Result provides same properties as getBoundingClientRect\n  let result = {\n    top: y,\n    left: x,\n    width: w,\n    height: h,\n    right: x + w,\n    bottom: y + h\n  };\n\n  // For the case of nested SVG (point annotations) and grouped\n  // lines or rects no adjustment needs to be made for scale.\n  // I assume that the scale is already being handled\n  // natively by virtue of the `transform` attribute.\n  if (!['svg', 'g'].includes(el.nodeName.toLowerCase())) {\n    result = scaleUp(findSVGAtPoint(rect.left, rect.top), result);\n  }\n\n  return result;\n}\n\n/**\n * Adjust scale from normalized scale (100%) to rendered scale.\n *\n * @param {SVGElement} svg The SVG to gather metadata from\n * @param {Object} rect A map of numeric values to scale\n * @return {Object} A copy of `rect` with values scaled up\n */\nexport function scaleUp(svg, rect) {\n  let result = {};\n  let { viewport } = getMetadata(svg);\n\n  Object.keys(rect).forEach((key) => {\n    result[key] = rect[key] * viewport.scale;\n  });\n\n  return result;\n}\n\n/**\n * Adjust scale from rendered scale to a normalized scale (100%).\n *\n * @param {SVGElement} svg The SVG to gather metadata from\n * @param {Object} rect A map of numeric values to scale\n * @return {Object} A copy of `rect` with values scaled down\n */\nexport function scaleDown(svg, rect) {\n  let result = {};\n  let { viewport } = getMetadata(svg);\n\n  Object.keys(rect).forEach((key) => {\n    result[key] = rect[key] / viewport.scale;\n  });\n\n  return result;\n}\n\n/**\n * Get the scroll position of an element, accounting for parent elements\n *\n * @param {Element} el The element to get the scroll position for\n * @return {Object} The scrollTop and scrollLeft position\n */\nexport function getScroll(el) {\n  let scrollTop = 0;\n  let scrollLeft = 0;\n  let parentNode = el;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    scrollTop += parentNode.scrollTop;\n    scrollLeft += parentNode.scrollLeft;\n  }\n\n  return { scrollTop, scrollLeft };\n}\n\n/**\n * Get the offset position of an element, accounting for parent elements\n *\n * @param {Element} el The element to get the offset position for\n * @return {Object} The offsetTop and offsetLeft position\n */\nexport function getOffset(el) {\n  let parentNode = el;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    if (parentNode.nodeName.toUpperCase() === 'SVG') {\n      break;\n    }\n  }\n\n  let rect = parentNode.getBoundingClientRect();\n\n  return { offsetLeft: rect.left, offsetTop: rect.top };\n}\n\n/**\n * Disable user ability to select text on page\n */\nexport function disableUserSelect() {\n  if (!userSelectStyleSheet.parentNode) {\n    document.head.appendChild(userSelectStyleSheet);\n  }\n}\n\n\n/**\n * Enable user ability to select text on page\n */\nexport function enableUserSelect() {\n  if (userSelectStyleSheet.parentNode) {\n    userSelectStyleSheet.parentNode.removeChild(userSelectStyleSheet);\n  }\n}\n\n/**\n * Get the metadata for a SVG container\n *\n * @param {SVGElement} svg The SVG container to get metadata for\n */\nexport function getMetadata(svg) {\n  return {\n    documentId: svg.getAttribute('data-pdf-annotate-document'),\n    pageNumber: parseInt(svg.getAttribute('data-pdf-annotate-page'), 10),\n    viewport: JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'))\n  };\n}\n","import EventEmitter from 'events';\nimport {\n  findAnnotationAtPoint,\n  findSVGAtPoint\n} from './utils';\n\nconst emitter = new EventEmitter;\n\nlet clickNode;\n\n/**\n * Handle document.click event\n *\n * @param {Event} e The DOM event to be handled\n */\ndocument.addEventListener('click', function handleDocumentClick(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\n\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\n\n  // Emit annotation:blur if clickNode is no longer clicked\n  if (clickNode && clickNode !== target) {\n    emitter.emit('annotation:blur', clickNode);\n  }\n\n  // Emit annotation:click if target was clicked\n  if (target) {\n    emitter.emit('annotation:click', target);\n  }\n\n  clickNode = target;\n});\n\n// let mouseOverNode;\n// document.addEventListener('mousemove', function handleDocumentMousemove(e) {\n//   let target = findAnnotationAtPoint(e.clientX, e.clientY);\n//\n//   // Emit annotation:mouseout if target was mouseout'd\n//   if (mouseOverNode && !target) {\n//     emitter.emit('annotation:mouseout', mouseOverNode);\n//   }\n//\n//   // Emit annotation:mouseover if target was mouseover'd\n//   if (target && mouseOverNode !== target) {\n//     emitter.emit('annotation:mouseover', target);\n//   }\n//\n//   mouseOverNode = target;\n// });\n\nexport function fireEvent() { emitter.emit(...arguments); };\nexport function addEventListener() { emitter.on(...arguments); };\nexport function removeEventListener() { emitter.removeListener(...arguments); };\n","import abstractFunction from '../utils/abstractFunction';\nimport { fireEvent } from '../UI/event';\n\n// Adapter should never be invoked publicly\nexport default class StoreAdapter {\n  /**\n   * Create a new StoreAdapter instance\n   *\n   * @param {Object} [definition] The definition to use for overriding abstract methods\n   */\n  constructor(definition = {}) {\n    // Copy each function from definition if it is a function we know about\n    Object.keys(definition).forEach((key) => {\n      if (typeof definition[key] === 'function' &&\n          typeof this[key] === 'function') {\n        this[key] = definition[key];\n      }\n    });\n  }\n\n  /**\n   * Get all the annotations for a given document and page number.\n   *\n   * @param {String} documentId The ID for the document the annotations belong to\n   * @param {Number} pageNumber The number of the page the annotations belong to\n   * @return {Promise}\n   */\n  __getAnnotations(documentId, pageNumber) { abstractFunction('getAnnotations'); }\n  get getAnnotations() { return this.__getAnnotations; }\n  set getAnnotations(fn) {\n    this.__getAnnotations = function getAnnotations(documentId, pageNumber) {\n      return fn(...arguments).then((annotations) => {\n        // TODO may be best to have this happen on the server\n        if (annotations.annotations) {\n          annotations.annotations.forEach((a) => {\n            a.documentId = documentId;\n          });\n        }\n        return annotations;\n      });\n    };\n  }\n\n  /**\n   * Get the definition for a specific annotation.\n   *\n   * @param {String} documentId The ID for the document the annotation belongs to\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  getAnnotation(documentId, annotationId) { abstractFunction('getAnnotation'); }\n\n  /**\n   * Add an annotation\n   *\n   * @param {String} documentId The ID for the document to add the annotation to\n   * @param {String} pageNumber The page number to add the annotation to\n   * @param {Object} annotation The definition for the new annotation\n   * @return {Promise}\n   */\n  __addAnnotation(documentId, pageNumber, annotation) { abstractFunction('addAnnotation'); }\n  get addAnnotation() { return this.__addAnnotation; }\n  set addAnnotation(fn) {\n    this.__addAnnotation = function addAnnotation(documentId, pageNumber, annotation) {\n      return fn(...arguments).then((annotation) => {\n        fireEvent('annotation:add', documentId, pageNumber, annotation);\n        return annotation;\n      });\n    };\n  }\n\n  /**\n   * Edit an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} pageNumber the page number of the annotation\n   * @param {Object} annotation The definition of the modified annotation\n   * @return {Promise}\n   */\n  __editAnnotation(documentId, pageNumber, annotation) { abstractFunction('editAnnotation'); }\n  get editAnnotation() { return this.__editAnnotation; }\n  set editAnnotation(fn) {\n    this.__editAnnotation = function editAnnotation(documentId, annotationId, annotation) {\n      return fn(...arguments).then((annotation) => {\n        fireEvent('annotation:edit', documentId, annotationId, annotation);\n        return annotation;\n      });\n    };\n  }\n\n  /**\n   * Delete an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  __deleteAnnotation(documentId, annotationId) { abstractFunction('deleteAnnotation'); }\n  get deleteAnnotation() { return this.__deleteAnnotation; }\n  set deleteAnnotation(fn) {\n    this.__deleteAnnotation = function deleteAnnotation(documentId, annotationId) {\n      return fn(...arguments).then((success) => {\n        if (success) {\n          fireEvent('annotation:delete', documentId, annotationId);\n        }\n        return success;\n      });\n    };\n  }\n\n  /**\n   * Get all the comments for an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  getComments(documentId, annotationId) { abstractFunction('getComments'); }\n\n  /**\n   * Add a new comment\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @param {Object} content The definition of the comment\n   * @return {Promise}\n   */\n  __addComment(documentId, annotationId, content) { abstractFunction('addComment'); }\n  get addComment() { return this.__addComment; }\n  set addComment(fn) {\n    this.__addComment = function addComment(documentId, annotationId, content) {\n      return fn(...arguments).then((comment) => {\n        fireEvent('comment:add', documentId, annotationId, comment);\n        return comment;\n      });\n    };\n  }\n\n  /**\n   * Delete a comment\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} commentId The ID for the comment\n   * @return {Promise}\n   */\n  __deleteComment(documentId, commentId) { abstractFunction('deleteComment'); }\n  get deleteComment() { return this.__deleteComment; }\n  set deleteComment(fn) {\n    this.__deleteComment = function deleteComment(documentId, commentId) {\n      return fn(...arguments).then((success) => {\n        if (success) {\n          fireEvent('comment:delete', documentId, commentId);\n        }\n        return success;\n      });\n    };\n  }\n}\n","const REGEXP = /[xy]/g\nconst PATTERN = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\n\nfunction replacement(c) {\n  let r = Math.random()*16|0;\n  let v = c == 'x' ? r : (r&0x3|0x8);\n  return v.toString(16);\n}\n\n/**\n * Generate a univierally unique identifier\n *\n * @return {String}\n */\nexport default function uuid() {\n  return PATTERN.replace(REGEXP, replacement);\n}\n","import uuid from '../utils/uuid';\nimport StoreAdapter from './StoreAdapter';\n\n// StoreAdapter for working with localStorage\n// This is ideal for testing, examples, and prototyping\nexport default class LocalStoreAdapter extends StoreAdapter {\n  constructor() {\n    super({\n      getAnnotations(documentId, pageNumber) {\n        return new Promise((resolve, reject) => {\n          let annotations = getAnnotations(documentId).filter((i) => {\n            return i.page === pageNumber && i.class === 'Annotation';\n          });\n\n          resolve({\n            documentId,\n            pageNumber,\n            annotations\n          });\n        });\n      },\n\n      getAnnotation(documentId, annotationId) {\n        return Promise.resolve(getAnnotations(documentId)[findAnnotation(documentId, annotationId)]);\n      },\n\n      addAnnotation(documentId, pageNumber, annotation) {\n        return new Promise((resolve, reject) => {\n          annotation.class = 'Annotation';\n          annotation.uuid = uuid();\n          annotation.page = pageNumber;\n\n          let annotations = getAnnotations(documentId);\n          annotations.push(annotation);\n          updateAnnotations(documentId, annotations);\n\n          resolve(annotation);\n        });\n      },\n\n      editAnnotation(documentId, annotationId, annotation) {\n        return new Promise((resolve, reject) => {\n          let annotations = getAnnotations(documentId);\n          annotations[findAnnotation(documentId, annotationId)] = annotation;\n          updateAnnotations(documentId, annotations);\n\n          resolve(annotation);\n        });\n      },\n\n      deleteAnnotation(documentId, annotationId) {\n        return new Promise((resolve, reject) => {\n          let index = findAnnotation(documentId, annotationId);\n          if (index > -1) {\n            let annotations = getAnnotations(documentId);\n            annotations.splice(index, 1);\n            updateAnnotations(documentId, annotations);\n          }\n\n          resolve(true);\n        });\n      },\n\n      getComments(documentId, annotationId) {\n        return new Promise((resolve, reject) => {\n          resolve(getAnnotations(documentId).filter((i) => {\n            return i.class === 'Comment' && i.annotation === annotationId;\n          }));\n        });\n      },\n\n      addComment(documentId, annotationId, content) {\n        return new Promise((resolve, reject) => {\n          let comment = {\n            class: 'Comment',\n            uuid: uuid(),\n            annotation: annotationId,\n            content: content\n          };\n\n          let annotations = getAnnotations(documentId);\n          annotations.push(comment);\n          updateAnnotations(documentId, annotations);\n\n          resolve(comment);\n        });\n      },\n\n      deleteComment(documentId, commentId) {\n        return new Promise((resolve, reject) => {\n          getAnnotations(documentId);\n          let index = -1;\n          let annotations = getAnnotations(documentId);\n          for (let i=0, l=annotations.length; i<l; i++) {\n            if (annotations[i].uuid === commentId) {\n              index = i;\n              break;\n            }\n          }\n\n          if (index > -1) {\n            annotations.splice(index, 1);\n            updateAnnotations(documentId, annotations);\n          }\n\n          resolve(true);\n        });\n      }\n    });\n  }\n}\n\nfunction getAnnotations(documentId) {\n  return JSON.parse(localStorage.getItem(`${documentId}/annotations`)) || [];\n}\n\nfunction updateAnnotations(documentId, annotations) {\n  localStorage.setItem(`${documentId}/annotations`, JSON.stringify(annotations));\n}\n\nfunction findAnnotation(documentId, annotationId) {\n  let index = -1;\n  let annotations = getAnnotations(documentId);\n  for (let i=0, l=annotations.length; i<l; i++) {\n    if (annotations[i].uuid === annotationId) {\n      index = i;\n      break;\n    }\n  }\n  return index;\n}\n","const UPPER_REGEX = /[A-Z]/g;\n\n// Don't convert these attributes from camelCase to hyphenated-attributes\nconst BLACKLIST = [\n  'viewBox'\n];\n\nlet keyCase = (key) => {\n  if (BLACKLIST.indexOf(key) === -1) {\n    key = key.replace(UPPER_REGEX, match => '-' + match.toLowerCase());\n  }\n  return key;\n}\n\n/**\n * Set attributes for a node from a map\n *\n * @param {Node} node The node to set attributes on\n * @param {Object} attributes The map of key/value pairs to use for attributes\n */\nexport default function setAttributes(node, attributes) {\n  Object.keys(attributes).forEach((key) => {\n    node.setAttribute(keyCase(key), attributes[key]);\n  });\n}\n","const REGEX_HASHLESS_HEX = /^([a-f0-9]{6}|[a-f0-9]{3})$/i;\n\n/**\n * Normalize a color value\n *\n * @param {String} color The color to normalize\n * @return {String}\n */\nexport default function normalizeColor(color) {\n  if (REGEX_HASHLESS_HEX.test(color)) {\n    color = `#${color}`;\n  }\n  return color;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGLineElements from an annotation definition.\n * This is used for anntations of type `strikeout`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement} A group of all lines to be rendered\n */\nexport default function renderLine(a) {\n  let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  setAttributes(group, {\n    stroke: normalizeColor(a.color || '#f00'),\n    strokeWidth: 1\n  });\n\n  a.rectangles.forEach((r) => {\n    let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n\n    setAttributes(line, {\n      x1: r.x,\n      y1: r.y,\n      x2: r.x + r.width,\n      y2: r.y,\n    });\n\n    group.appendChild(line);\n  });\n\n  return group;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGPathElement from an annotation definition.\n * This is used for anntations of type `drawing`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGPathElement} The path to be rendered\n */\nexport default function renderPath(a) {\n  let d = [];\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n  \n  for (let i=0, l=a.lines.length; i<l; i++) {\n    var p1 = a.lines[i];\n    var p2 = a.lines[i+1];\n    if (p2) {\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\n    }\n  }\n  \n  setAttributes(path, {\n    d: `${d.join(' ')}Z`,\n    stroke: normalizeColor(a.color || '#000'),\n    strokeWidth: a.width || 1,\n    fill: 'none'\n  });\n\n  return path;\n}\n","import setAttributes from '../utils/setAttributes';\n\nconst SIZE = 25;\nconst D = 'M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z';\n\n/**\n * Create SVGElement from an annotation definition.\n * This is used for anntations of type `comment`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGElement} A svg to be rendered\n */\nexport default function renderPoint(a) {\n  let outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  let innerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n  setAttributes(outerSVG,  {\n    width: SIZE,\n    height: SIZE,\n    x: a.x,\n    y: a.y\n  });\n\n  setAttributes(innerSVG, {\n    width: SIZE,\n    height: SIZE,\n    x: 0,\n    y: (SIZE * 0.05) * -1,\n    viewBox: '0 0 1000 1000'\n  });\n\n  setAttributes(rect, {\n    width: SIZE,\n    height: SIZE,\n    stroke: '#000',\n    fill: '#ff0'\n  });\n\n  setAttributes(path, {\n    d: D,\n    strokeWidth: 50,\n    stroke: '#000',\n    fill: '#fff'\n  });\n\n  innerSVG.appendChild(path);\n  outerSVG.appendChild(rect);\n  outerSVG.appendChild(innerSVG);\n\n  return outerSVG;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGRectElements from an annotation definition.\n * This is used for anntations of type `area` and `highlight`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement|SVGRectElement} A group of all rects to be rendered\n */\nexport default function renderRect(a) {\n  if (a.type === 'highlight') {\n    let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    setAttributes(group, {\n      fill: normalizeColor(a.color || '#ff0'),\n      fillOpacity: 0.2\n    });\n    \n    a.rectangles.forEach((r) => {\n      group.appendChild(createRect(r));\n    });\n\n    return group;\n  } else {\n    let rect = createRect(a);\n    setAttributes(rect, {\n      stroke: normalizeColor(a.color || '#f00'),\n      fill: 'none'\n    });\n\n    return rect;\n  }\n}\n\nfunction createRect(r) {\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n\n  setAttributes(rect, {\n    x: r.x,\n    y: r.y,\n    width: r.width,\n    height: r.height\n  });\n\n  return rect;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGTextElement from an annotation definition.\n * This is used for anntations of type `textbox`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGTextElement} A text to be rendered\n */\nexport default function renderText(a) {\n  var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n\n  setAttributes(text, {\n    x: a.x,\n    y: a.y + parseInt(a.size, 10),\n    fill: normalizeColor(a.color || '#000'),\n    fontSize: a.size\n  });\n  text.innerHTML = a.content;\n\n  return text;\n}\n","// Using native Object.assign instead of the polyfill\nimport renderLine from './renderLine';\nimport renderPath from './renderPath';\nimport renderPoint from './renderPoint';\nimport renderRect from './renderRect';\nimport renderText from './renderText';\n\nconst isFirefox = /firefox/i.test(navigator.userAgent);\n\n/**\n * Get the x/y translation to be used for transforming the annotations\n * based on the rotation of the viewport.\n *\n * @param {Object} viewport The viewport data from the page\n * @return {Object}\n */\nfunction getTranslation(viewport) {\n  let x;\n  let y;\n\n  // Modulus 360 on the rotation so that we only\n  // have to worry about four possible values.\n  switch(viewport.rotation % 360) {\n    case 0:\n      x = y = 0;\n      break;\n    case 90:\n      x = 0;\n      y = (viewport.width / viewport.scale) * -1;\n      break;\n    case 180:\n      x = (viewport.width / viewport.scale) * -1;\n      y = (viewport.height / viewport.scale) * -1;\n      break;\n    case 270:\n      x = (viewport.height / viewport.scale) * -1;\n      y = 0;\n      break;\n  }\n\n  return { x, y };\n}\n\n/**\n * Transform the rotation and scale of a node using SVG's native transform attribute.\n *\n * @param {Node} node The node to be transformed\n * @param {Object} viewport The page's viewport data\n * @return {Node}\n */\nfunction transform(node, viewport) {\n  let trans = getTranslation(viewport);\n\n  // Let SVG natively transform the element\n  node.setAttribute('transform', `scale(${viewport.scale}) rotate(${viewport.rotation}) translate(${trans.x}, ${trans.y})`);\n  \n  // Manually adjust x/y for nested SVG nodes\n  if (!isFirefox && node.nodeName.toLowerCase() === 'svg') {\n    node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\n    node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\n\n    let x = parseInt(node.getAttribute('x', 10));\n    let y = parseInt(node.getAttribute('y', 10));\n    let width = parseInt(node.getAttribute('width'), 10);\n    let height = parseInt(node.getAttribute('height'), 10);\n    let path = node.querySelector('path');\n    let svg = path.parentNode;\n   \n    // Scale width/height\n    [node, svg, path, node.querySelector('rect')].forEach((n) => {\n      n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\n      n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\n    });\n\n    // Transform path but keep scale at 100% since it will be handled natively\n    transform(path, Object.assign({}, viewport, { scale: 1 }));\n    \n    switch(viewport.rotation % 360) {\n      case 90:\n        node.setAttribute('x', viewport.width - y - width);\n        node.setAttribute('y', x);\n        svg.setAttribute('x', 1);\n        svg.setAttribute('y', 0);\n        break;\n      case 180:\n        node.setAttribute('x', viewport.width - x - width);\n        node.setAttribute('y', viewport.height - y - height);\n        svg.setAttribute('y', 2);\n        break;\n      case 270:\n        node.setAttribute('x', y);\n        node.setAttribute('y', viewport.height - x - height);\n        svg.setAttribute('x', -1);\n        svg.setAttribute('y', 0);\n        break;\n    }\n  }\n\n  return node;\n}\n\n/**\n * Append an annotation as a child of an SVG.\n *\n * @param {SVGElement} svg The SVG element to append the annotation to\n * @param {Object} annotation The annotation definition to render and append\n * @param {Object} viewport The page's viewport data\n * @return {SVGElement} A node that was created and appended by this function\n */\nexport default function appendChild(svg, annotation, viewport) {\n  if (!viewport) {\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\n  }\n  \n  let child;\n  switch (annotation.type) {\n    case 'area':\n    case 'highlight':\n      child = renderRect(annotation);\n      break;\n    case 'strikeout':\n      child = renderLine(annotation);\n      break;\n    case 'point':\n      child = renderPoint(annotation);\n      break;\n    case 'textbox':\n      child = renderText(annotation);\n      break;\n    case 'drawing':\n      child = renderPath(annotation);\n      break;\n  }\n\n  // If no type was provided for an annotation it will result in node being null.\n  // Skip appending/transforming if node doesn't exist.\n  if (child) {\n    // Set attributes\n    child.setAttribute('data-pdf-annotate-id', annotation.uuid);\n    child.setAttribute('data-pdf-annotate-type', annotation.type);\n    child.setAttribute('aria-hidden', true);\n\n    svg.appendChild(transform(child, viewport));\n  }\n\n  return child;\n}\n","/**\n * Create a node that is only visible to screen readers\n *\n * @param {String} content The text content that should be read by screen reader\n * @param {String} [annotationId] The ID of the annotation assocaited\n * @return {Element} An Element that is only visible to screen readers\n */\nexport default function createScreenReaderOnly(content, annotationId) {\n  let node = document.createElement('div');\n  let text = document.createTextNode(content);\n  node.appendChild(text);\n  node.setAttribute('id', `pdf-annotate-screenreader-${annotationId}`);\n  node.style.position = 'absolute';\n  node.style.left = '-10000px';\n  node.style.top = 'auto';\n  node.style.width = '1px';\n  node.style.height = '1px';\n  node.style.overflow = 'hidden';\n  return node;\n}\n","import {\n  pointIntersectsRect,\n  scaleUp,\n  scaleDown\n} from '../UI/utils'; \n\n/**\n * Insert an element at a point within the document.\n * This algorithm will only insert within an element amidst it's text content.\n *\n * @param {Element} el The element to be inserted\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page number to limit elements to\n * @param {Boolean} insertBefore Whether the element is to be inserted before or after x\n * @return {Boolean} True if element was able to be inserted, otherwise false\n */\nexport default function insertElementWithinElement(el, x, y, pageNumber, insertBefore) {\n  const OFFSET_ADJUST = 2;\n\n  // If inserting before adjust `x` by looking for element a few px to the right\n  // Otherwise adjust a few px to the left\n  // This is to allow a little tolerance by searching within the box, instead\n  // of getting a false negative by testing right on the border.\n  x = Math.max(x + (OFFSET_ADJUST * (insertBefore ? 1 : -1)), 0);\n\n  let node = textLayerElementFromPoint(x, y + OFFSET_ADJUST, pageNumber);\n  if (!node) {\n    return false;\n  }\n  \n  // Now that node has been found inverse the adjustment for `x`.\n  // This is done to accomodate tolerance by cutting off on the outside of the\n  // text boundary, instead of missing a character by cutting off within.\n  x = x + (OFFSET_ADJUST * (insertBefore ? -1 : 1));\n\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let left = scaleDown(svg, {left: node.getBoundingClientRect().left}).left - svg.getBoundingClientRect().left;\n  let temp = node.cloneNode(true);\n  let head = temp.innerHTML.split('');\n  let tail = [];\n\n  // Insert temp off screen\n  temp.style.position = 'absolute';\n  temp.style.top = '-10000px';\n  temp.style.left = '-10000px';\n  document.body.appendChild(temp);\n\n  while (head.length) {\n    // Don't insert within HTML tags\n    if (head[head.length - 1] === '>') {\n      while(head.length) {\n        tail.unshift(head.pop());\n        if (tail[0] === '<') {\n          break;\n        }\n      }\n    }\n    \n    // Check if width of temp based on current head value satisfies x\n    temp.innerHTML = head.join('');\n    let width = scaleDown(svg, {width: temp.getBoundingClientRect().width}).width;\n    if (left + width <= x) {\n      break;\n    }\n    tail.unshift(head.pop());\n  }\n  \n  // Update original node with new markup, including element to be inserted\n  node.innerHTML = head.join('') + el.outerHTML + tail.join('');\n  temp.parentNode.removeChild(temp);\n\n  return true;\n}\n\n/**\n * Get a text layer element at a given point on a page\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page to limit elements to\n * @return {Element} First text layer element found at the point\n */\nfunction textLayerElementFromPoint(x, y, pageNumber) {\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let rect = svg.getBoundingClientRect();\n  y = scaleUp(svg, {y}).y + rect.top;\n  x = scaleUp(svg, {x}).x + rect.left;\n  return [...svg.parentNode.querySelectorAll('.textLayer [data-canvas-width]')].filter((el) => {\n    return pointIntersectsRect(x, y, el.getBoundingClientRect());\n  })[0];\n}\n","import insertElementWithinElement from './insertElementWithinElement';\nimport { pointIntersectsRect } from '../UI/utils';\nimport { scaleUp } from '../UI/utils'; \n\n/**\n * Insert an element at a point within the document.\n * This algorithm will try to insert between elements if possible.\n * It will however use `insertElementWithinElement` if it is more accurate.\n *\n * @param {Element} el The element to be inserted\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page number to limit elements to\n * @return {Boolean} True if element was able to be inserted, otherwise false\n */\nexport default function insertElementWithinChildren(el, x, y, pageNumber) {\n  // Try and use most accurate method of inserting within an element\n  if (insertElementWithinElement(el, x, y, pageNumber, true)) {\n    return true;\n  }\n\n  // Fall back to inserting between elements\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let rect = svg.getBoundingClientRect();\n  let nodes = [...svg.parentNode.querySelectorAll('.textLayer > div')];\n\n  y = scaleUp(svg, {y}).y + rect.top;\n  x = scaleUp(svg, {x}).x + rect.left;\n\n  // Find the best node to insert before\n  for (let i=0, l=nodes.length; i<l; i++) {\n    let n = nodes[i];\n    let r = n.getBoundingClientRect();\n    if (y <= r.top) {\n      n.parentNode.insertBefore(el, n);\n      return true;\n    }\n  }\n\n  // If all else fails try to append to the bottom\n  let textLayer = svg.parentNode.querySelector('.textLayer');\n  if (textLayer) {\n    let textRect = textLayer.getBoundingClientRect();\n    if (pointIntersectsRect(x, y, textRect)) {\n      textLayer.appendChild(el);\n      return true;\n    }\n  }\n\n  return false;\n}\n","/**\n * Insert a comment into the DOM to be available by screen reader\n *\n * @param {Object} comment The comment to be inserted\n */\nexport default function insertScreenReaderComment(comment) {\n  if (!comment) {\n    return;\n  }\n\n  let list = document.querySelector(`#pdf-annotate-screenreader-${comment.annotation} ol`);\n  if (list) {\n    let item = document.createElement('li');\n    item.setAttribute('id', `pdf-annotate-screenreader-comment-${comment.uuid}`);\n    item.appendChild(document.createTextNode(`${comment.content}`));\n    list.appendChild(item);\n  }\n}\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport insertScreenReaderComment from './insertScreenReaderComment';\n\n/**\n * Insert the comments into the DOM to be available by screen reader\n *\n * Example output:\n *   <div class=\"screenReaderOnly\">\n *    <div>Begin highlight 1</div>\n *    <ol aria-label=\"Comments\">\n *      <li>Foo</li>\n *      <li>Bar</li>\n *      <li>Baz</li>\n *      <li>Qux</li>\n *    </ol>\n *  </div>\n *  <div>Some highlighted text goes here...</div>\n *  <div class=\"screenReaderOnly\">End highlight 1</div>\n *\n * NOTE: `screenReaderOnly` is not a real class, just used for brevity\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The ID of the annotation\n * @param {Array} [comments] Optionally preloaded comments to be rendered\n * @return {Promise}\n */\nexport default function renderScreenReaderComments(documentId, annotationId, comments) {\n  let promise;\n\n  if (Array.isArray(comments)) {\n    promise = Promise.resolve(comments);\n  } else {\n    promise = PDFJSAnnotate.getStoreAdapter().getComments(documentId, annotationId);\n  }\n\n  return promise.then((comments) => {\n    // Node needs to be found by querying DOM as it may have been inserted as innerHTML\n    // leaving `screenReaderNode` as an invalid reference (see `insertElementWithinElement`).\n    let node = document.getElementById(`pdf-annotate-screenreader-${annotationId}`);\n    if (node) { \n      let list = document.createElement('ol');\n      list.setAttribute('id', `pdf-annotate-screenreader-comment-list-${annotationId}`);\n      list.setAttribute('aria-label', 'Comments');\n      node.appendChild(list);\n      comments.forEach(insertScreenReaderComment);\n    }\n  });\n}\n","import createScreenReaderOnly from './createScreenReaderOnly';\nimport insertElementWithinChildren from './insertElementWithinChildren';\nimport insertElementWithinElement from './insertElementWithinElement';\nimport renderScreenReaderComments from './renderScreenReaderComments';\n\n// Annotation types that support comments\nconst COMMENT_TYPES = ['highlight', 'point', 'area'];\n\n/**\n * Insert a hint into the DOM for screen readers for a specific annotation.\n *\n * @param {Object} annotation The annotation to insert a hint for\n * @param {Number} num The number of the annotation out of all annotations of the same type\n */\nexport default function insertScreenReaderHint(annotation, num = 0) {\n  switch (annotation.type) {\n    case 'highlight':\n    case 'strikeout':\n      let rects = annotation.rectangles;\n      let first = rects[0];\n      let last = rects[rects.length - 1];\n\n      insertElementWithinElement(\n        createScreenReaderOnly(`Begin ${annotation.type} annotation ${num}`, annotation.uuid),\n        first.x, first.y, annotation.page, true\n      );\n\n      insertElementWithinElement(\n        createScreenReaderOnly(`End ${annotation.type} annotation ${num}`, `${annotation.uuid}-end`),\n        last.x + last.width, last.y, annotation.page, false\n      );\n      break;\n\n    case 'textbox':\n    case 'point':\n      let text = annotation.type === 'textbox' ? ` (content: ${annotation.content})` : '';\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`${annotation.type} annotation ${num}${text}`, annotation.uuid),\n        annotation.x, annotation.y, annotation.page\n      );\n      break;\n\n    case 'drawing':\n    case 'area':\n      let x = typeof annotation.x !== 'undefined' ? annotation.x : annotation.lines[0][0];\n      let y = typeof annotation.y !== 'undefined' ? annotation.y : annotation.lines[0][1];\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\n        x, y, annotation.page\n      );\n      break;\n  }\n\n  // Include comments in screen reader hint\n  if (COMMENT_TYPES.includes(annotation.type)) {\n    renderScreenReaderComments(annotation.documentId, annotation.uuid);\n  }\n}\n","import insertScreenReaderHint from './insertScreenReaderHint';\nimport renderScreenReaderHints from './renderScreenReaderHints';\nimport insertScreenReaderComment from './insertScreenReaderComment';\nimport renderScreenReaderComments from './renderScreenReaderComments';\nimport { addEventListener } from '../UI/event';\nimport PDFJSAnnotate from '../PDFJSAnnotate';\n\n/**\n * Initialize the event handlers for keeping screen reader hints synced with data\n */\nexport default function initEventHandlers() {\n  addEventListener('annotation:add', (documentId, pageNumber, annotation) => {\n    reorderAnnotationsByType(documentId, pageNumber, annotation.type);\n  });\n  addEventListener('annotation:edit', (documentId, annotationId, annotation) => {\n    reorderAnnotationsByType(documentId, annotation.page, annotation.type);\n  });\n  addEventListener('annotation:delete', removeAnnotation);\n  addEventListener('comment:add', insertComment);\n  addEventListener('comment:delete', removeComment);\n}\n\n/**\n * Reorder the annotation numbers by annotation type\n *\n * @param {String} documentId The ID of the document\n * @param {Number} pageNumber The page number of the annotations\n * @param {Strig} type The annotation type\n */\nfunction reorderAnnotationsByType(documentId, pageNumber, type) {\n  PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, pageNumber)\n    .then((annotations) => {\n      return annotations.annotations.filter((a) => {\n        return a.type === type;\n      });\n    })\n    .then((annotations) => {\n      annotations.forEach((a) => {\n        removeAnnotation(documentId, a.uuid);\n      });\n\n      return annotations;\n    })\n    .then(renderScreenReaderHints);\n}\n\n/**\n * Remove the screen reader hint for an annotation\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The Id of the annotation\n */\nfunction removeAnnotation(documentId, annotationId) {\n  removeElementById(`pdf-annotate-screenreader-${annotationId}`);\n  removeElementById(`pdf-annotate-screenreader-${annotationId}-end`);\n}\n\n/**\n * Insert a screen reader hint for a comment\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The ID of tha assocated annotation\n * @param {Object} comment The comment to insert a hint for\n */\nfunction insertComment(documentId, annotationId, comment) {\n  let list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\n  let promise;\n\n  if (!list) {\n    promise = renderScreenReaderComments(documentId, annotationId, []).then(() => {\n      list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\n      return true;\n    });\n  } else {\n    promise = Promise.resolve(true);\n  }\n\n  promise.then(() => {\n    insertScreenReaderComment(comment);\n  });\n}\n\n/**\n * Remove a screen reader hint for a comment\n *\n * @param {String} documentId The ID of the document\n * @param {String} commentId The ID of the comment\n */\nfunction removeComment(documentId, commentId) {\n  removeElementById(`pdf-annotate-screenreader-comment-${commentId}`);\n}\n\n/**\n * Remove an element from the DOM by it's ID if it exists\n *\n * @param {String} elementID The ID of the element to be removed\n */\nfunction removeElementById(elementId) {\n  let el = document.getElementById(elementId);\n  if (el) {\n    el.parentNode.removeChild(el);\n  }\n}\n","import insertScreenReaderHint from './insertScreenReaderHint';\nimport initEventHandlers from './initEventHandlers';\n\n// TODO This is not the right place for this to live\ninitEventHandlers();\n\n/**\n * Insert hints into the DOM for screen readers.\n *\n * @param {Array} annotations The annotations that hints are inserted for\n */\nexport default function renderScreenReaderHints(annotations) {\n  annotations = Array.isArray(annotations) ? annotations : [];\n\n  // Insert hints for each type\n  Object.keys(SORT_TYPES).forEach((type) => {\n    let sortBy = SORT_TYPES[type];\n    annotations\n      .filter((a) => a.type === type)\n      .sort(sortBy)\n      .forEach((a, i) => insertScreenReaderHint(a, i + 1));\n  });\n}\n\n// Sort annotations first by y, then by x.\n// This allows hints to be injected in the order they appear,\n// which makes numbering them easier.\nfunction sortByPoint(a, b) {\n  if (a.y < b.y) {\n    return a.x - b.x;\n  } else {\n    return 1;\n  }\n}\n\n// Sort annotation by it's first rectangle\nfunction sortByRectPoint(a, b) {\n  return sortByPoint(a.rectangles[0], b.rectangles[0]);\n}\n\n// Sort annotation by it's first line\nfunction sortByLinePoint(a, b) {\n  let lineA = a.lines[0];\n  let lineB = b.lines[0];\n  return sortByPoint(\n    {x: lineA[0], y: lineA[1]},\n    {x: lineB[0], y: lineB[1]}\n  );\n}\n\n// Arrange supported types and associated sort methods\nconst SORT_TYPES = {\n  'highlight': sortByRectPoint,\n  'strikeout': sortByRectPoint,\n  'drawing': sortByLinePoint,\n  'textbox': sortByPoint,\n  'point': sortByPoint,\n  'area': sortByPoint\n};\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from './appendChild';\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\n\n/**\n * Render the response from PDFJSAnnotate.getStoreAdapter().getAnnotations to SVG\n *\n * @param {SVGElement} svg The SVG element to render the annotations to\n * @param {Object} viewport The page viewport data\n * @param {Object} data The response from PDFJSAnnotate.getStoreAdapter().getAnnotations\n * @return {Promise} Settled once rendering has completed\n *  A settled Promise will be either:\n *    - fulfilled: SVGElement\n *    - rejected: Error\n */\nexport default function render(svg, viewport, data) {\n  return new Promise((resolve, reject) => {\n    // Reset the content of the SVG\n    svg.innerHTML = ''; \n    svg.setAttribute('data-pdf-annotate-container', true);\n    svg.setAttribute('data-pdf-annotate-viewport', JSON.stringify(viewport));\n    svg.removeAttribute('data-pdf-annotate-document');\n    svg.removeAttribute('data-pdf-annotate-page');\n\n    // If there's no data nothing can be done\n    if (!data) {\n      return resolve(svg);\n    }\n\n    svg.setAttribute('data-pdf-annotate-document', data.documentId);\n    svg.setAttribute('data-pdf-annotate-page', data.pageNumber);\n  \n    // Make sure annotations is an array\n    if (!Array.isArray(data.annotations) || data.annotations.length === 0) {\n      return resolve(svg);\n    }\n\n    // Append annotation to svg\n    data.annotations.forEach((a) => {\n      appendChild(svg, a, viewport);\n    });\n\n    resolve(svg);\n  });\n}\n","import PDFJSAnnotate from '../PDFJSAnnotate';\n\nimport appendChild from '../render/appendChild';\nimport {\n  addEventListener,\n  removeEventListener\n} from './event';\nimport {\n  BORDER_COLOR,\n  disableUserSelect,\n  enableUserSelect,\n  findSVGContainer,\n  findSVGAtPoint,\n  getAnnotationRect,\n  getMetadata,\n  scaleDown,\n  scaleUp\n} from './utils';\n\nlet _enabled = false;\nlet isDragging = false, overlay;\nlet dragOffsetX, dragOffsetY, dragStartX, dragStartY;\nconst OVERLAY_BORDER_SIZE = 3;\n\n/**\n * Create an overlay for editing an annotation.\n *\n * @param {Element} target The annotation element to apply overlay for\n */\nfunction createEditOverlay(target) {\n  destroyEditOverlay();\n\n  overlay = document.createElement('div');\n  let anchor = document.createElement('a');\n  let parentNode = findSVGContainer(target).parentNode;\n  let id = target.getAttribute('data-pdf-annotate-id');\n  let rect = getAnnotationRect(target);\n  let styleLeft = rect.left - OVERLAY_BORDER_SIZE;\n  let styleTop = rect.top - OVERLAY_BORDER_SIZE;\n  \n  overlay.setAttribute('id', 'pdf-annotate-edit-overlay');\n  overlay.setAttribute('data-target-id', id);\n  overlay.style.boxSizing = 'content-box';\n  overlay.style.position = 'absolute';\n  overlay.style.top = `${styleTop}px`;\n  overlay.style.left = `${styleLeft}px`;\n  overlay.style.width = `${rect.width}px`;\n  overlay.style.height = `${rect.height}px`;\n  overlay.style.border = `${OVERLAY_BORDER_SIZE}px solid ${BORDER_COLOR}`;\n  overlay.style.borderRadius = `${OVERLAY_BORDER_SIZE}px`;\n\n  anchor.innerHTML = '×';\n  anchor.setAttribute('href', 'javascript://');\n  anchor.style.background = '#fff';\n  anchor.style.borderRadius = '20px';\n  anchor.style.border = '1px solid #bbb';\n  anchor.style.color = '#bbb';\n  anchor.style.fontSize = '16px';\n  anchor.style.padding = '2px';\n  anchor.style.textAlign = 'center';\n  anchor.style.textDecoration = 'none';\n  anchor.style.position = 'absolute';\n  anchor.style.top = '-13px';\n  anchor.style.right = '-13px';\n  anchor.style.width = '25px';\n  anchor.style.height = '25px';\n  \n  overlay.appendChild(anchor);\n  parentNode.appendChild(overlay);\n  document.addEventListener('click', handleDocumentClick);\n  document.addEventListener('keyup', handleDocumentKeyup);\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  anchor.addEventListener('click', deleteAnnotation);\n  anchor.addEventListener('mouseover', () => {\n    anchor.style.color = '#35A4DC';\n    anchor.style.borderColor = '#999';\n    anchor.style.boxShadow = '0 1px 1px #ccc';\n  });\n  anchor.addEventListener('mouseout', () => {\n    anchor.style.color = '#bbb';\n    anchor.style.borderColor = '#bbb';\n    anchor.style.boxShadow = '';\n  });\n  overlay.addEventListener('mouseover', () => {\n    if (!isDragging) { anchor.style.display = ''; }\n  });\n  overlay.addEventListener('mouseout', () => {\n    anchor.style.display = 'none';\n  });\n}\n\n/**\n * Destroy the edit overlay if it exists.\n */\nfunction destroyEditOverlay() {\n  if (overlay) {\n    overlay.parentNode.removeChild(overlay);\n    overlay = null;\n  }\n\n  document.removeEventListener('click', handleDocumentClick);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  enableUserSelect();\n}\n\n/**\n * Delete currently selected annotation\n */\nfunction deleteAnnotation() {\n  if (!overlay) { return; }\n\n  let annotationId = overlay.getAttribute('data-target-id');\n  let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let { documentId } = getMetadata(svg);\n\n  [...nodes].forEach((n) => {\n    n.parentNode.removeChild(n);\n  });\n  \n  PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId);\n\n  destroyEditOverlay();\n}\n\n/**\n * Handle document.click event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentClick(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\n\n  // Remove current overlay\n  let overlay = document.getElementById('pdf-annotate-edit-overlay');\n  if (overlay) {\n    if (isDragging || e.target === overlay) {\n      return;\n    }\n\n    destroyEditOverlay();\n  }\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentKeyup(e) {\n  if (overlay && e.keyCode === 46 &&\n      e.target.nodeName.toLowerCase() !== 'textarea' &&\n      e.target.nodeName.toLowerCase() !== 'input') {\n    deleteAnnotation();\n  }\n}\n\n/**\n * Handle document.mousedown event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMousedown(e) {\n  if (e.target !== overlay) { return; }\n\n  // Highlight and strikeout annotations are bound to text within the document.\n  // It doesn't make sense to allow repositioning these types of annotations.\n  let annotationId = overlay.getAttribute('data-target-id');\n  let target = document.querySelector(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let type = target.getAttribute('data-pdf-annotate-type');\n\n  if (type === 'highlight' || type === 'strikeout') { return; }\n\n  isDragging = true;\n  dragOffsetX = e.clientX;\n  dragOffsetY = e.clientY;\n  dragStartX = overlay.offsetLeft;\n  dragStartY = overlay.offsetTop;\n\n  overlay.style.background = 'rgba(255, 255, 255, 0.7)';\n  overlay.style.cursor = 'move';\n  overlay.querySelector('a').style.display = 'none';\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  document.addEventListener('mouseup', handleDocumentMouseup);\n  disableUserSelect();\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMousemove(e) {\n  let annotationId = overlay.getAttribute('data-target-id');\n  let parentNode = overlay.parentNode;\n  let rect = parentNode.getBoundingClientRect();\n  let y = (dragStartY + (e.clientY - dragOffsetY));\n  let x = (dragStartX + (e.clientX - dragOffsetX));\n  let minY = 0;\n  let maxY = rect.height;\n  let minX = 0;\n  let maxX = rect.width;\n\n  if (y > minY && y + overlay.offsetHeight < maxY) {\n    overlay.style.top = `${y}px`;\n  }\n\n  if (x > minX && x + overlay.offsetWidth < maxX) {\n    overlay.style.left = `${x}px`;\n  }\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMouseup(e) {\n  let annotationId = overlay.getAttribute('data-target-id');\n  let target = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let type = target[0].getAttribute('data-pdf-annotate-type');\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let { documentId } = getMetadata(svg);\n  \n  overlay.querySelector('a').style.display = '';\n\n  function getDelta(propX, propY) {\n    return calcDelta(parseInt(target[0].getAttribute(propX), 10), parseInt(target[0].getAttribute(propY), 10));\n  }\n\n  function calcDelta(x, y) {\n    return {\n      deltaX: OVERLAY_BORDER_SIZE + scaleDown(svg, {x: overlay.offsetLeft}).x - x,\n      deltaY: OVERLAY_BORDER_SIZE + scaleDown(svg, {y: overlay.offsetTop}).y - y\n    };\n  }\n\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\n    if (['area', 'highlight', 'point', 'textbox'].indexOf(type) > -1) {\n      let { deltaX, deltaY } = getDelta('x', 'y');\n      [...target].forEach((t, i) => {\n        if (deltaY !== 0) {\n          let modelY = parseInt(t.getAttribute('y'), 10) + deltaY;\n          let viewY = modelY;\n\n          if (type === 'textbox') {\n            viewY += annotation.size;\n          }\n\n          if (type === 'point') {\n            viewY = scaleUp(svg, { viewY }).viewY;\n          }\n\n          t.setAttribute('y', viewY);\n          if (annotation.rectangles) {\n            annotation.rectangles[i].y = modelY;\n          } else if (annotation.y) {\n            annotation.y = modelY;\n          }\n        }\n        if (deltaX !== 0) {\n          let modelX = parseInt(t.getAttribute('x'), 10) + deltaX;\n          let viewX = modelX;\n\n          if (type === 'point') {\n            viewX = scaleUp(svg, { viewX }).viewX;\n          }\n\n          t.setAttribute('x', viewX);\n          if (annotation.rectangles) {\n            annotation.rectangles[i].x = modelX;\n          } else if (annotation.x) {\n            annotation.x = modelX;\n          }\n        }\n      });\n    // } else if (type === 'strikeout') {\n    //   let { deltaX, deltaY } = getDelta('x1', 'y1');\n    //   [...target].forEach(target, (t, i) => {\n    //     if (deltaY !== 0) {\n    //       t.setAttribute('y1', parseInt(t.getAttribute('y1'), 10) + deltaY);\n    //       t.setAttribute('y2', parseInt(t.getAttribute('y2'), 10) + deltaY);\n    //       annotation.rectangles[i].y = parseInt(t.getAttribute('y1'), 10);\n    //     }\n    //     if (deltaX !== 0) {\n    //       t.setAttribute('x1', parseInt(t.getAttribute('x1'), 10) + deltaX);\n    //       t.setAttribute('x2', parseInt(t.getAttribute('x2'), 10) + deltaX);\n    //       annotation.rectangles[i].x = parseInt(t.getAttribute('x1'), 10);\n    //     }\n    //   });\n    } else if (type === 'drawing') {\n      let rect = scaleDown(svg, getAnnotationRect(target[0]));\n      let [originX, originY] = annotation.lines[0];\n      let { deltaX, deltaY } = calcDelta(originX, originY);\n\n      // origin isn't necessarily at 0/0 in relation to overlay x/y\n      // adjust the difference between overlay and drawing coords\n      deltaY += (originY - rect.top);\n      deltaX += (originX - rect.left);\n\n      annotation.lines.forEach((line, i) => {\n        let [x, y] = annotation.lines[i];\n        annotation.lines[i][0] = x + deltaX;\n        annotation.lines[i][1] = y + deltaY;\n      });\n\n      target[0].parentNode.removeChild(target[0]);\n      appendChild(svg, annotation);\n    }\n\n    PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\n  });\n\n  setTimeout(() => {\n    isDragging = false;\n  }, 0);\n\n  overlay.style.background = '';\n  overlay.style.cursor = '';\n\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  enableUserSelect();\n}\n\n/**\n * Handle annotation.click event\n *\n * @param {Element} e The annotation element that was clicked\n */\nfunction handleAnnotationClick(target) {\n  createEditOverlay(target);\n}\n\n/**\n * Enable edit mode behavior.\n */\nexport function enableEdit () {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  addEventListener('annotation:click', handleAnnotationClick);\n};\n\n/**\n * Disable edit mode behavior.\n */\nexport function disableEdit () {\n  destroyEditOverlay();\n\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  removeEventListener('annotation:click', handleAnnotationClick);\n};\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet _penSize;\nlet _penColor;\nlet path;\nlet lines;\n\n/**\n * Handle document.mousedown event\n */\nfunction handleDocumentMousedown() {\n  path = null;\n  lines = [];\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentMouseup(e) {\n  let svg;\n  if (lines.length > 1 && (svg = findSVGAtPoint(e.clientX, e.clientY))) {\n    let { documentId, pageNumber } = getMetadata(svg);\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\n        type: 'drawing',\n        width: _penSize,\n        color: _penColor,\n        lines\n      }\n    ).then((annotation) => {\n      if (path) {\n        svg.removeChild(path);\n      }\n\n      appendChild(svg, annotation);\n    });\n  }\n\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentMousemove(e) {\n  savePoint(e.clientX, e.clientY);\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    lines = null;\n    path.parentNode.removeChild(path);\n    document.removeEventListener('mousemove', handleDocumentMousemove);\n    document.removeEventListener('mouseup', handleDocumentMouseup);\n  }\n}\n\n/**\n * Save a point to the line being drawn.\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n */\nfunction savePoint(x, y) {\n  let svg = findSVGAtPoint(x, y);\n  if (!svg) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  let point = scaleDown(svg, {\n    x: x - rect.left,\n    y: y - rect.top\n  });\n\n  lines.push([point.x, point.y]);\n\n  if (lines.length <= 1) {\n    return;\n  }\n\n  if (path) {\n    svg.removeChild(path);\n  }\n\n  path = appendChild(svg, {\n    type: 'drawing',\n    color: _penColor,\n    width: _penSize,\n    lines\n  });\n}\n\n/**\n * Set the attributes of the pen.\n *\n * @param {Number} penSize The size of the lines drawn by the pen\n * @param {String} penColor The color of the lines drawn by the pen\n */\nexport function setPen(penSize = 1, penColor = '000000') {\n  _penSize = parseInt(penSize, 10);\n  _penColor = penColor;\n}\n\n/**\n * Enable the pen behavior\n */\nexport function enablePen() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  document.addEventListener('keyup', handleDocumentKeyup);\n  disableUserSelect();\n}\n\n/**\n * Disable the pen behavior\n */\nexport function disablePen() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  enableUserSelect();\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet input;\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} The DOM event to be handled\n */\nfunction handleDocumentMouseup(e) {\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\n    return\n  }\n  \n  input = document.createElement('input');\n  input.setAttribute('id', 'pdf-annotate-point-input');\n  input.setAttribute('placeholder', 'Enter comment');\n  input.style.border = `3px solid ${BORDER_COLOR}`;\n  input.style.borderRadius = '3px';\n  input.style.position = 'absolute';\n  input.style.top = `${e.clientY}px`;\n  input.style.left = `${e.clientX}px`;\n\n  input.addEventListener('blur', handleInputBlur);\n  input.addEventListener('keyup', handleInputKeyup);\n\n  document.body.appendChild(input);\n  input.focus();\n}\n\n/**\n * Handle input.blur event\n */\nfunction handleInputBlur() {\n  savePoint();\n}\n\n/**\n * Handle input.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleInputKeyup(e) {\n  if (e.keyCode === 27) {\n    closeInput();\n  } else if (e.keyCode === 13) {\n    savePoint();\n  }\n}\n\n/**\n * Save a new point annotation from input\n */\nfunction savePoint() {\n  if (input.value.trim().length > 0) {\n    let clientX = parseInt(input.style.left, 10);\n    let clientY = parseInt(input.style.top, 10);\n    let content = input.value.trim();\n    let svg = findSVGAtPoint(clientX, clientY);\n    if (!svg) {\n      return;\n    }\n\n    let rect = svg.getBoundingClientRect();\n    let { documentId, pageNumber } = getMetadata(svg);\n    let annotation = Object.assign({\n        type: 'point'\n      }, scaleDown(svg, {\n        x: clientX - rect.left,\n        y: clientY - rect.top\n      })\n    );\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n      .then((annotation) => {\n        PDFJSAnnotate.getStoreAdapter().addComment(\n          documentId,\n          annotation.uuid,\n          content\n        );\n\n        appendChild(svg, annotation);\n      });\n  }\n\n  closeInput();\n}\n\n/**\n * Close the input element\n */\nfunction closeInput() {\n  input.removeEventListener('blur', handleInputBlur);\n  input.removeEventListener('keyup', handleInputKeyup);\n  document.body.removeChild(input);\n  input = null;\n}\n\n/**\n * Enable point annotation behavior\n */\nexport function enablePoint() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Disable point annotation behavior\n */\nexport function disablePoint() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  getMetadata,\n  getOffset,\n  scaleDown,\n  scaleUp\n} from './utils';\n\nlet _enabled = false;\nlet _type;\nlet overlay;\nlet originY;\nlet originX;\n\n/**\n * Get the current window selection as rects\n *\n * @return {Array} An Array of rects\n */\nfunction getSelectionRects() {\n  try {\n    let selection = window.getSelection();\n    let range = selection.getRangeAt(0);\n    let rects = range.getClientRects();\n\n    if (rects.length > 0 &&\n        rects[0].width > 0 &&\n        rects[0].height > 0) {\n      return rects;\n    }\n  } catch (e) {}\n  \n  return null;\n}\n\n/**\n * Handle document.mousedown event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMousedown(e) {\n  let svg;\n  if (_type !== 'area' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  originY = e.clientY;\n  originX = e.clientX;\n\n  overlay = document.createElement('div');\n  overlay.style.position = 'absolute';\n  overlay.style.top = `${originY - rect.top}px`;\n  overlay.style.left = `${originX - rect.left}px`;\n  overlay.style.border = `3px solid ${BORDER_COLOR}`;\n  overlay.style.borderRadius = '3px';\n  svg.parentNode.appendChild(overlay);\n  \n  document.addEventListener('mousemove', handleDocumentMousemove);\n  disableUserSelect();\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMousemove(e) {\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let rect = svg.getBoundingClientRect();\n\n  if (originX + (e.clientX - originX) < rect.right) {\n    overlay.style.width = `${e.clientX - originX}px`;\n  }\n\n  if (originY + (e.clientY - originY) < rect.bottom) {\n    overlay.style.height = `${e.clientY - originY}px`;\n  }\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  let rects;\n  if (_type !== 'area' && (rects = getSelectionRects())) {\n    let svg = findSVGAtPoint(rects[0].left, rects[0].top);\n    saveRect(_type, [...rects].map((r) => {\n      return {\n        top: r.top,\n        left: r.left,\n        width: r.width,\n        height: r.height\n      };\n    }));\n  } else if (_type === 'area' && overlay) {\n    let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n    let rect = svg.getBoundingClientRect();\n    saveRect(_type, [{\n      top: parseInt(overlay.style.top, 10) + rect.top,\n      left: parseInt(overlay.style.left, 10) + rect.left,\n      width: parseInt(overlay.style.width, 10),\n      height: parseInt(overlay.style.height, 10)\n    }]);\n\n    overlay.parentNode.removeChild(overlay);\n    overlay = null;\n\n    document.removeEventListener('mousemove', handleDocumentMousemove);\n    enableUserSelect();\n  }\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    let selection = window.getSelection();\n    selection.removeAllRanges();\n    if (overlay && overlay.parentNode) {\n      overlay.parentNode.removeChild(overlay);\n      overlay = null;\n      document.removeEventListener('mousemove', handleDocumentMousemove);\n    }\n  }\n}\n\n/**\n * Save a rect annotation\n *\n * @param {String} type The type of rect (area, highlight, strikeout)\n * @param {Array} rects The rects to use for annotation\n * @param {String} color The color of the rects\n */\nfunction saveRect(type, rects, color) {\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\n  let node;\n  let annotation;\n\n  if (!svg) {\n    return;\n  }\n\n  let boundingRect = svg.getBoundingClientRect();\n\n  if (!color) {\n    if (type === 'highlight') {\n      color = 'FFFF00';\n    } else if (type === 'strikeout') {\n      color = 'FF0000';\n    }\n  }\n\n  // Initialize the annotation\n  annotation = {\n    type,\n    color,\n    rectangles: [...rects].map((r) => {\n      let offset = 0;\n\n      if (type === 'strikeout') {\n        offset = r.height / 2;\n      }\n\n      return scaleDown(svg, {\n        y: (r.top + offset) - boundingRect.top,\n        x: r.left - boundingRect.left,\n        width: r.width,\n        height: r.height\n      });\n    }).filter((r) => r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1)\n  };\n  \n  // Short circuit if no rectangles exist\n  if (annotation.rectangles.length === 0) {\n    return;\n  }\n\n  // Special treatment for area as it only supports a single rect\n  if (type === 'area') {\n    let rect = annotation.rectangles[0];\n    delete annotation.rectangles;\n    annotation.x = rect.x;\n    annotation.y = rect.y;\n    annotation.width = rect.width;\n    annotation.height = rect.height;\n  }\n\n  let { documentId, pageNumber } = getMetadata(svg);\n\n  // Add the annotation\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n    .then((annotation) => {\n      appendChild(svg, annotation);\n    });\n}\n\n/**\n * Enable rect behavior\n */\nexport function enableRect(type) {\n  _type = type;\n  \n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  document.addEventListener('keyup', handleDocumentKeyup);\n}\n\n/**\n * Disable rect behavior\n */\nexport function disableRect() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet input;\nlet _textSize;\nlet _textColor;\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n\n  input = document.createElement('input');\n  input.setAttribute('id', 'pdf-annotate-text-input');\n  input.setAttribute('placeholder', 'Enter text');\n  input.style.border = `3px solid ${BORDER_COLOR}`;\n  input.style.borderRadius = '3px';\n  input.style.position = 'absolute';\n  input.style.top = `${e.clientY}px`;\n  input.style.left = `${e.clientX}px`;\n  input.style.fontSize = `${_textSize}px`;\n\n  input.addEventListener('blur', handleInputBlur);\n  input.addEventListener('keyup', handleInputKeyup);\n\n  document.body.appendChild(input);\n  input.focus();\n}\n\n/**\n * Handle input.blur event\n */\nfunction handleInputBlur() {\n  saveText();\n}\n\n/**\n * Handle input.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleInputKeyup(e) {\n  if (e.keyCode === 27) {\n    closeInput();\n  } else if (e.keyCode === 13) {\n    saveText();\n  }\n}\n\n/**\n * Save a text annotation from input\n */\nfunction saveText() {\n  if (input.value.trim().length > 0) {\n    let clientX = parseInt(input.style.left, 10);\n    let clientY = parseInt(input.style.top, 10);\n    let svg = findSVGAtPoint(clientX, clientY);\n    if (!svg) {\n      return;\n    }\n\n    let { documentId, pageNumber } = getMetadata(svg);\n    let rect = svg.getBoundingClientRect();\n    let annotation = Object.assign({\n        type: 'textbox',\n        size: _textSize,\n        color: _textColor,\n        content: input.value.trim()\n      }, scaleDown(svg, {\n        x: clientX - rect.left,\n        y: clientY -  rect.top,\n        width: input.offsetWidth,\n        height: input.offsetHeight\n      })\n    );\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n      .then((annotation) => {\n        appendChild(svg, annotation);\n      });\n  }\n  \n  closeInput();\n}\n\n/**\n * Close the input\n */\nfunction closeInput() {\n  if (input) {\n    input.removeEventListener('blur', handleInputBlur);\n    input.removeEventListener('keyup', handleInputKeyup);\n    document.body.removeChild(input);\n    input = null;\n  }\n}\n\n/**\n * Set the text attributes\n *\n * @param {Number} textSize The size of the text\n * @param {String} textColor The color of the text\n */\nexport function setText(textSize = 12, textColor = '000000') {\n  _textSize = parseInt(textSize, 10);\n  _textColor = textColor;\n}\n\n\n/**\n * Enable text behavior\n */\nexport function enableText() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n\n/**\n * Disable text behavior\n */\nexport function disableText() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\n\n// Template for creating a new page\nconst PAGE_TEMPLATE = `\n  <div style=\"visibility: hidden;\" class=\"page\" data-loaded=\"false\">\n    <div class=\"canvasWrapper\">\n      <canvas></canvas>\n    </div>\n    <svg class=\"annotationLayer\"></svg>\n    <div class=\"textLayer\"></div>\n  </div>\n`;\n\n/**\n * Create a new page to be appended to the DOM.\n *\n * @param {Number} pageNumber The page number that is being created\n * @return {HTMLElement}\n */\nexport function createPage(pageNumber) {\n  let temp = document.createElement('div');\n  temp.innerHTML = PAGE_TEMPLATE;\n\n  let page = temp.children[0];\n  let canvas = page.querySelector('canvas');\n\n  page.setAttribute('id', `pageContainer${pageNumber}`);\n  page.setAttribute('data-page-number', pageNumber);\n\n  canvas.mozOpaque = true;\n  canvas.setAttribute('id', `page${pageNumber}`);\n\n  return page;\n}\n\n/**\n * Render a page that has already been created.\n *\n * @param {Number} pageNumber The page number to be rendered\n * @param {Object} renderOptions The options for rendering\n * @return {Promise} Settled once rendering has completed\n *  A settled Promise will be either:\n *    - fulfilled: [pdfPage, annotations]\n *    - rejected: Error\n */\nexport function renderPage(pageNumber, renderOptions) {\n  let {\n    documentId,\n    pdfDocument,\n    scale,\n    rotate\n  } = renderOptions;\n\n  // Load the page and annotations\n  return Promise.all([\n    pdfDocument.getPage(pageNumber),\n    PDFJSAnnotate.getAnnotations(documentId, pageNumber)\n  ]).then(([pdfPage, annotations]) => {\n    let page = document.getElementById(`pageContainer${pageNumber}`);\n    let svg = page.querySelector('.annotationLayer');\n    let canvas = page.querySelector('.canvasWrapper canvas');\n    let canvasContext = canvas.getContext('2d', {alpha: false});\n    let viewport = pdfPage.getViewport(scale, rotate);\n    let transform = scalePage(pageNumber, viewport, canvasContext);\n\n    // Render the page\n    return Promise.all([\n      pdfPage.render({ canvasContext, viewport, transform }),\n      PDFJSAnnotate.render(svg, viewport, annotations)\n    ]).then(() => {\n      // Text content is needed for a11y, but is also necessary for creating\n      // highlight and strikeout annotations which require selecting text.\n      return pdfPage.getTextContent({normalizeWhitespace: true}).then((textContent) => {\n        return new Promise((resolve, reject) => {\n          // Render text layer for a11y of text content\n          let textLayer = page.querySelector(`.textLayer`);\n          \n          // Modern PDF.js text layer rendering\n          const textLayerBuilder = {\n            textLayerDiv: textLayer,\n            renderingDone: false,\n            viewport: viewport,\n            textDivs: [],\n            textContentItemsStr: [],\n            textContentStream: textContent\n          };\n          \n          // Create text layer with the new API\n          import('pdfjs-dist').then(({ renderTextLayer }) => {\n            const task = renderTextLayer({\n              textContent: textContent,\n              container: textLayer,\n              viewport: viewport,\n              enhanceTextSelection: true\n            });\n            \n            task.promise.then(() => {\n              // Enable a11y for annotations after text layer is rendered\n              try {\n                renderScreenReaderHints(annotations.annotations);\n                resolve();\n              } catch (e) {\n                reject(e);\n              }\n            }).catch(reject);\n          }).catch(reject);\n        });\n      });\n    }).then(() => {\n      // Indicate that the page was loaded\n      page.setAttribute('data-loaded', 'true');\n\n      return [pdfPage, annotations];\n    });\n  });\n}\n\n/**\n * Scale the elements of a page.\n *\n * @param {Number} pageNumber The page number to be scaled\n * @param {Object} viewport The viewport of the PDF page (see pdfPage.getViewport(scale, rotate))\n * @param {Object} context The canvas context that the PDF page is rendered to\n * @return {Array} The transform data for rendering the PDF page\n */\nfunction scalePage(pageNumber, viewport, context) {\n  let page = document.getElementById(`pageContainer${pageNumber}`);\n  let canvas = page.querySelector('.canvasWrapper canvas');\n  let svg = page.querySelector('.annotationLayer');\n  let wrapper = page.querySelector('.canvasWrapper');\n  let textLayer = page.querySelector('.textLayer');\n  let outputScale = getOutputScale(context);\n  let transform = !outputScale.scaled ? null : [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\n  let sfx = approximateFraction(outputScale.sx);\n  let sfy = approximateFraction(outputScale.sy);\n\n  // Adjust width/height for scale\n  page.style.visibility = '';\n  canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\n  canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\n  canvas.style.width = roundToDivide(viewport.width, sfx[1]) + 'px';\n  canvas.style.height = roundToDivide(viewport.height, sfx[1]) + 'px';\n  svg.setAttribute('width', viewport.width);\n  svg.setAttribute('height', viewport.height);\n  svg.style.width = `${viewport.width}px`;\n  svg.style.height = `${viewport.height}px`;\n  page.style.width = `${viewport.width}px`;\n  page.style.height = `${viewport.height}px`;\n  wrapper.style.width = `${viewport.width}px`;\n  wrapper.style.height = `${viewport.height}px`;\n  textLayer.style.width = `${viewport.width}px`;\n  textLayer.style.height = `${viewport.height}px`;\n\n  return transform;\n}\n\n/**\n * The following methods are taken from mozilla/pdf.js and as such fall under\n * the Apache License (http://www.apache.org/licenses/).\n *\n * Original source can be found at mozilla/pdf.js:\n * https://github.com/mozilla/pdf.js/blob/master/web/ui_utils.js\n */\n\n/**\n * Approximates a float number as a fraction using Farey sequence (max order\n * of 8).\n *\n * @param {Number} x Positive float number\n * @return {Array} Estimated fraction: the first array item is a numerator,\n *                 the second one is a denominator.\n */\nfunction approximateFraction(x) {\n  // Fast path for int numbers or their inversions.\n  if (Math.floor(x) === x) {\n    return [x, 1];\n  }\n\n  const xinv = 1 / x;\n  const limit = 8;\n  if (xinv > limit) {\n    return [1, limit];\n  } else if (Math.floor(xinv) === xinv) {\n    return [1, xinv];\n  }\n\n  const x_ = x > 1 ? xinv : x;\n  \n  // a/b and c/d are neighbours in Farey sequence.\n  let a = 0, b = 1, c = 1, d = 1;\n  \n  // Limit search to order 8.\n  while (true) {\n    // Generating next term in sequence (order of q).\n    let p = a + c, q = b + d;\n    if (q > limit) {\n      break;\n    }\n    if (x_ <= p / q) {\n      c = p; d = q;\n    } else {\n      a = p; b = q;\n    }\n  }\n\n  // Select closest of neighbours to x.\n  if (x_ - a / b < c / d - x_) {\n    return x_ === x ? [a, b] : [b, a];\n  } else {\n    return x_ === x ? [c, d] : [d, c];\n  }\n}\n\nfunction getOutputScale(ctx) {\n  let devicePixelRatio = window.devicePixelRatio || 1;\n  let backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\n                          ctx.mozBackingStorePixelRatio ||\n                          ctx.msBackingStorePixelRatio ||\n                          ctx.oBackingStorePixelRatio ||\n                          ctx.backingStorePixelRatio || 1;\n  let pixelRatio = devicePixelRatio / backingStoreRatio;\n  return {\n    sx: pixelRatio,\n    sy: pixelRatio,\n    scaled: pixelRatio !== 1\n  };\n}\n\nfunction roundToDivide(x, div) {\n  let r = x % div;\n  return r === 0 ? x : Math.round(x - r + div);\n}\n","import { addEventListener, removeEventListener, fireEvent } from './event';\nimport { disableEdit, enableEdit } from './edit';\nimport { disablePen, enablePen, setPen } from './pen';\nimport { disablePoint, enablePoint } from './point';\nimport { disableRect, enableRect } from './rect';\nimport { disableText, enableText, setText } from './text';\nimport { createPage, renderPage } from './page';\n\nexport default {\n  addEventListener, removeEventListener, fireEvent,\n  disableEdit, enableEdit,\n  disablePen, enablePen, setPen,\n  disablePoint, enablePoint,\n  disableRect, enableRect,\n  disableText, enableText, setText,\n  createPage, renderPage\n};\n","import StoreAdapter from './adapter/StoreAdapter';\nimport LocalStoreAdapter from './adapter/LocalStoreAdapter';\nimport render from './render';\nimport UI from './UI';\n\nexport default {\n  /**\n   * Abstract class that needs to be defined so PDFJSAnnotate\n   * knows how to communicate with your server.\n   */\n  StoreAdapter,\n\n  /**\n   * Implementation of StoreAdapter that stores annotation data to localStorage.\n   */\n  LocalStoreAdapter,\n\n  /**\n   * Abstract instance of StoreAdapter\n   */\n  __storeAdapter: new StoreAdapter(),\n\n  /**\n   * Getter for the underlying StoreAdapter property\n   *\n   * @return {StoreAdapter}\n   */\n  getStoreAdapter() {\n    return this.__storeAdapter;\n  },\n\n  /**\n   * Setter for the underlying StoreAdapter property\n   *\n   * @param {StoreAdapter} adapter The StoreAdapter implementation to be used.\n   */\n  setStoreAdapter(adapter) {\n    // TODO this throws an error when bundled\n    // if (!(adapter instanceof StoreAdapter)) {\n    //   throw new Error('adapter must be an instance of StoreAdapter');\n    // }\n\n    this.__storeAdapter = adapter;\n  },\n\n  /**\n   * UI is a helper for instrumenting UI interactions for creating,\n   * editing, and deleting annotations in the browser.\n   */\n  UI,\n\n  /**\n   * Render the annotations for a page in the PDF Document\n   *\n   * @param {SVGElement} svg The SVG element that annotations should be rendered to\n   * @param {PageViewport} viewport The PDFPage.getViewport data\n   * @param {Object} data The StoreAdapter.getAnnotations data\n   * @return {Promise}\n   */\n  render,\n\n  /**\n   * Convenience method for getting annotation data\n   *\n   * @alias StoreAdapter.getAnnotations\n   * @param {String} documentId The ID of the document\n   * @param {String} pageNumber The page number\n   * @return {Promise}\n   */\n  getAnnotations(documentId, pageNumber) {\n    return this.getStoreAdapter().getAnnotations(...arguments);\n  }\n}\n"],"names":["abstractFunction","name","EventEmitter","BORDER_COLOR","userSelectStyleSheet","findSVGContainer","node","parentNode","findSVGAtPoint","x","y","elements","i","l","el","rect","pointIntersectsRect","findAnnotationAtPoint","svg","getOffsetAnnotationRect","getAnnotationRect","offsetLeft","offsetTop","getOffset","h","w","LINE_OFFSET","minX","maxX","minY","maxY","p","s","result","scaleUp","viewport","getMetadata","key","scaleDown","disableUserSelect","enableUserSelect","emitter","clickNode","e","target","fireEvent","addEventListener","removeEventListener","StoreAdapter","definition","documentId","pageNumber","fn","annotations","a","annotationId","annotation","success","content","comment","commentId","REGEXP","PATTERN","replacement","c","r","uuid","LocalStoreAdapter","resolve","reject","getAnnotations","findAnnotation","updateAnnotations","index","UPPER_REGEX","BLACKLIST","keyCase","match","setAttributes","attributes","REGEX_HASHLESS_HEX","normalizeColor","color","renderLine","group","line","renderPath","d","path","p1","p2","SIZE","D","renderPoint","outerSVG","innerSVG","renderRect","createRect","renderText","text","isFirefox","getTranslation","transform","trans","width","height","n","appendChild","child","createScreenReaderOnly","insertElementWithinElement","insertBefore","textLayerElementFromPoint","left","temp","head","tail","insertElementWithinChildren","nodes","textLayer","textRect","insertScreenReaderComment","list","item","renderScreenReaderComments","comments","promise","PDFJSAnnotate","COMMENT_TYPES","insertScreenReaderHint","num","rects","first","last","initEventHandlers","reorderAnnotationsByType","removeAnnotation","insertComment","removeComment","type","renderScreenReaderHints","removeElementById","elementId","SORT_TYPES","sortBy","sortByPoint","b","sortByRectPoint","sortByLinePoint","lineA","lineB","render","data","_enabled","isDragging","overlay","dragOffsetX","dragOffsetY","dragStartX","dragStartY","OVERLAY_BORDER_SIZE","createEditOverlay","destroyEditOverlay","anchor","id","styleLeft","styleTop","handleDocumentClick","handleDocumentKeyup","handleDocumentMousedown","deleteAnnotation","handleDocumentMousemove","handleDocumentMouseup","getDelta","propX","propY","calcDelta","deltaX","deltaY","t","modelY","viewY","modelX","viewX","originX","originY","handleAnnotationClick","enableEdit","disableEdit","_penSize","_penColor","lines","savePoint","point","setPen","penSize","penColor","enablePen","disablePen","input","handleInputBlur","handleInputKeyup","closeInput","clientX","clientY","enablePoint","disablePoint","_type","getSelectionRects","saveRect","boundingRect","offset","enableRect","disableRect","_textSize","_textColor","saveText","setText","textSize","textColor","enableText","disableText","PAGE_TEMPLATE","createPage","page","canvas","renderPage","renderOptions","pdfDocument","scale","rotate","pdfPage","canvasContext","scalePage","textContent","renderTextLayer","context","wrapper","outputScale","getOutputScale","sfx","approximateFraction","sfy","roundToDivide","xinv","limit","x_","q","ctx","devicePixelRatio","backingStoreRatio","pixelRatio","div","UI","adapter"],"mappings":"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"}