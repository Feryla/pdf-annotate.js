(function(E,X){typeof exports=="object"&&typeof module<"u"?module.exports=X():typeof define=="function"&&define.amd?define(X):(E=typeof globalThis<"u"?globalThis:E||self,E.PDFAnnotate=X())})(this,function(){"use strict";function E(e){throw new Error(e+" is not implemented")}const X={},H="#00BFFF",k=document.createElement("style");k.textContent=`
  body {
    -webkit-user-select: none;
       -moz-user-select: none;
        -ms-user-select: none;
            user-select: none;
  }
`,k.setAttribute("data-pdf-annotate-user-select","true");function ot(e){let t=e;for(;(t=t.parentNode)&&t!==document;)if(t.nodeName.toUpperCase()==="SVG"&&t.getAttribute("data-pdf-annotate-container")==="true")return t;return null}function x(e,t){let n=document.querySelectorAll('svg[data-pdf-annotate-container="true"]');for(let r=0,i=n.length;r<i;r++){let o=n[r],l=o.getBoundingClientRect();if(U(e,t,l))return o}return null}function lt(e,t){let n=x(e,t);if(!n)return;let r=n.querySelectorAll("[data-pdf-annotate-type]");for(let i=0,o=r.length;i<o;i++){let l=r[i];if(U(e,t,at(l)))return l}return null}function U(e,t,n){return t>=n.top&&t<=n.bottom&&e>=n.left&&e<=n.right}function at(e){let t=ie(e),{offsetLeft:n,offsetTop:r}=xe(e);return{top:t.top+r,left:t.left+n,right:t.right+n,bottom:t.bottom+r}}function ie(e){let t=0,n=0,r=0,i=0,o=e.getBoundingClientRect();const l=16;switch(e.nodeName.toLowerCase()){case"path":let a,u,c,m;e.getAttribute("d").replace(/Z/,"").split("M").splice(1).forEach(v=>{var b=v.split(" ").map(T=>parseInt(T,10));(typeof a>"u"||b[0]<a)&&(a=b[0]),(typeof u>"u"||b[2]>u)&&(u=b[2]),(typeof c>"u"||b[1]<c)&&(c=b[1]),(typeof m>"u"||b[3]>m)&&(m=b[3])}),t=m-c,n=u-a,r=a,i=c;break;case"line":t=parseInt(e.getAttribute("y2"),10)-parseInt(e.getAttribute("y1"),10),n=parseInt(e.getAttribute("x2"),10)-parseInt(e.getAttribute("x1"),10),r=parseInt(e.getAttribute("x1"),10),i=parseInt(e.getAttribute("y1"),10),t===0&&(t+=l,i-=l/2);break;case"text":t=o.height,n=o.width,r=parseInt(e.getAttribute("x"),10),i=parseInt(e.getAttribute("y"),10)-t;break;case"g":let{offsetLeft:g,offsetTop:y}=xe(e);t=o.height,n=o.width,r=o.left-g,i=o.top-y,e.getAttribute("data-pdf-annotate-type")==="strikeout"&&(t+=l,i-=l/2);break;case"rect":case"svg":t=parseInt(e.getAttribute("height"),10),n=parseInt(e.getAttribute("width"),10),r=parseInt(e.getAttribute("x"),10),i=parseInt(e.getAttribute("y"),10);break}let s={top:i,left:r,width:n,height:t,right:r+n,bottom:i+t};return["svg","g"].includes(e.nodeName.toLowerCase())||(s=I(x(o.left,o.top),s)),s}function I(e,t){let n={},{viewport:r}=L(e);return Object.keys(t).forEach(i=>{n[i]=t[i]*r.scale}),n}function C(e,t){let n={},{viewport:r}=L(e);return Object.keys(t).forEach(i=>{n[i]=t[i]/r.scale}),n}function xe(e){let t=e;for(;(t=t.parentNode)&&t!==document&&t.nodeName.toUpperCase()!=="SVG";);let n=t.getBoundingClientRect();return{offsetLeft:n.left,offsetTop:n.top}}function oe(){k.parentNode||document.head.appendChild(k)}function W(){k.parentNode&&k.parentNode.removeChild(k)}function L(e){return{documentId:e.getAttribute("data-pdf-annotate-document"),pageNumber:parseInt(e.getAttribute("data-pdf-annotate-page"),10),viewport:JSON.parse(e.getAttribute("data-pdf-annotate-viewport"))}}const Y=new X;let G;document.addEventListener("click",function(t){if(!x(t.clientX,t.clientY))return;let n=lt(t.clientX,t.clientY);G&&G!==n&&Y.emit("annotation:blur",G),n&&Y.emit("annotation:click",n),G=n});function B(){Y.emit(...arguments)}function _(){Y.on(...arguments)}function Ae(){Y.removeListener(...arguments)}class le{constructor(t={}){Object.keys(t).forEach(n=>{typeof t[n]=="function"&&typeof this[n]=="function"&&(this[n]=t[n])})}__getAnnotations(t,n){E("getAnnotations")}get getAnnotations(){return this.__getAnnotations}set getAnnotations(t){this.__getAnnotations=function(r,i){return t(...arguments).then(o=>(o.annotations&&o.annotations.forEach(l=>{l.documentId=r}),o))}}getAnnotation(t,n){E("getAnnotation")}__addAnnotation(t,n,r){E("addAnnotation")}get addAnnotation(){return this.__addAnnotation}set addAnnotation(t){this.__addAnnotation=function(r,i,o){return t(...arguments).then(l=>(B("annotation:add",r,i,l),l))}}__editAnnotation(t,n,r){E("editAnnotation")}get editAnnotation(){return this.__editAnnotation}set editAnnotation(t){this.__editAnnotation=function(r,i,o){return t(...arguments).then(l=>(B("annotation:edit",r,i,l),l))}}__deleteAnnotation(t,n){E("deleteAnnotation")}get deleteAnnotation(){return this.__deleteAnnotation}set deleteAnnotation(t){this.__deleteAnnotation=function(r,i){return t(...arguments).then(o=>(o&&B("annotation:delete",r,i),o))}}getComments(t,n){E("getComments")}__addComment(t,n,r){E("addComment")}get addComment(){return this.__addComment}set addComment(t){this.__addComment=function(r,i,o){return t(...arguments).then(l=>(B("comment:add",r,i,l),l))}}__deleteComment(t,n){E("deleteComment")}get deleteComment(){return this.__deleteComment}set deleteComment(t){this.__deleteComment=function(r,i){return t(...arguments).then(o=>(o&&B("comment:delete",r,i),o))}}}const st=/[xy]/g,dt="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";function ut(e){let t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)}function ve(){return dt.replace(st,ut)}class ct extends le{constructor(){super({getAnnotations(t,n){return new Promise((r,i)=>{let o=S(t).filter(l=>l.page===n&&l.class==="Annotation");r({documentId:t,pageNumber:n,annotations:o})})},getAnnotation(t,n){return Promise.resolve(S(t)[ae(t,n)])},addAnnotation(t,n,r){return new Promise((i,o)=>{r.class="Annotation",r.uuid=ve(),r.page=n;let l=S(t);l.push(r),D(t,l),i(r)})},editAnnotation(t,n,r){return new Promise((i,o)=>{let l=S(t);l[ae(t,n)]=r,D(t,l),i(r)})},deleteAnnotation(t,n){return new Promise((r,i)=>{let o=ae(t,n);if(o>-1){let l=S(t);l.splice(o,1),D(t,l)}r(!0)})},getComments(t,n){return new Promise((r,i)=>{r(S(t).filter(o=>o.class==="Comment"&&o.annotation===n))})},addComment(t,n,r){return new Promise((i,o)=>{let l={class:"Comment",uuid:ve(),annotation:n,content:r},s=S(t);s.push(l),D(t,s),i(l)})},deleteComment(t,n){return new Promise((r,i)=>{S(t);let o=-1,l=S(t);for(let s=0,a=l.length;s<a;s++)if(l[s].uuid===n){o=s;break}o>-1&&(l.splice(o,1),D(t,l)),r(!0)})}})}}function S(e){return JSON.parse(localStorage.getItem(`${e}/annotations`))||[]}function D(e,t){localStorage.setItem(`${e}/annotations`,JSON.stringify(t))}function ae(e,t){let n=-1,r=S(e);for(let i=0,o=r.length;i<o;i++)if(r[i].uuid===t){n=i;break}return n}const ft=/[A-Z]/g,pt=["viewBox"];let mt=e=>(pt.indexOf(e)===-1&&(e=e.replace(ft,t=>"-"+t.toLowerCase())),e);function w(e,t){Object.keys(t).forEach(n=>{e.setAttribute(mt(n),t[n])})}const ht=/^([a-f0-9]{6}|[a-f0-9]{3})$/i;function M(e){return ht.test(e)&&(e=`#${e}`),e}function gt(e){let t=document.createElementNS("http://www.w3.org/2000/svg","g");return w(t,{stroke:M(e.color||"#f00"),strokeWidth:1}),e.rectangles.forEach(n=>{let r=document.createElementNS("http://www.w3.org/2000/svg","line");w(r,{x1:n.x,y1:n.y,x2:n.x+n.width,y2:n.y}),t.appendChild(r)}),t}function yt(e){let t=[],n=document.createElementNS("http://www.w3.org/2000/svg","path");for(let o=0,l=e.lines.length;o<l;o++){var r=e.lines[o],i=e.lines[o+1];i&&t.push(`M${r[0]} ${r[1]} ${i[0]} ${i[1]}`)}return w(n,{d:`${t.join(" ")}Z`,stroke:M(e.color||"#000"),strokeWidth:e.width||1,fill:"none"}),n}const R=25,bt="M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z";function xt(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","rect"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return w(t,{width:R,height:R,x:e.x,y:e.y}),w(n,{width:R,height:R,x:0,y:R*.05*-1,viewBox:"0 0 1000 1000"}),w(r,{width:R,height:R,stroke:"#000",fill:"#ff0"}),w(i,{d:bt,strokeWidth:50,stroke:"#000",fill:"#fff"}),n.appendChild(i),t.appendChild(r),t.appendChild(n),t}function At(e){if(e.type==="highlight"){let t=document.createElementNS("http://www.w3.org/2000/svg","g");return w(t,{fill:M(e.color||"#ff0"),fillOpacity:.2}),e.rectangles.forEach(n=>{t.appendChild(Ee(n))}),t}else{let t=Ee(e);return w(t,{stroke:M(e.color||"#f00"),fill:"none"}),t}}function Ee(e){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");return w(t,{x:e.x,y:e.y,width:e.width,height:e.height}),t}function vt(e){var t=document.createElementNS("http://www.w3.org/2000/svg","text");return w(t,{x:e.x,y:e.y+parseInt(e.size,10),fill:M(e.color||"#000"),fontSize:e.size}),t.innerHTML=e.content,t}const Et=/firefox/i.test(navigator.userAgent);function wt(e){let t,n;switch(e.rotation%360){case 0:t=n=0;break;case 90:t=0,n=e.width/e.scale*-1;break;case 180:t=e.width/e.scale*-1,n=e.height/e.scale*-1;break;case 270:t=e.height/e.scale*-1,n=0;break}return{x:t,y:n}}function we(e,t){let n=wt(t);if(e.setAttribute("transform",`scale(${t.scale}) rotate(${t.rotation}) translate(${n.x}, ${n.y})`),!Et&&e.nodeName.toLowerCase()==="svg"){e.setAttribute("x",parseInt(e.getAttribute("x"),10)*t.scale),e.setAttribute("y",parseInt(e.getAttribute("y"),10)*t.scale);let r=parseInt(e.getAttribute("x",10)),i=parseInt(e.getAttribute("y",10)),o=parseInt(e.getAttribute("width"),10),l=parseInt(e.getAttribute("height"),10),s=e.querySelector("path"),a=s.parentNode;switch([e,a,s,e.querySelector("rect")].forEach(u=>{u.setAttribute("width",parseInt(u.getAttribute("width"),10)*t.scale),u.setAttribute("height",parseInt(u.getAttribute("height"),10)*t.scale)}),we(s,Object.assign({},t,{scale:1})),t.rotation%360){case 90:e.setAttribute("x",t.width-i-o),e.setAttribute("y",r),a.setAttribute("x",1),a.setAttribute("y",0);break;case 180:e.setAttribute("x",t.width-r-o),e.setAttribute("y",t.height-i-l),a.setAttribute("y",2);break;case 270:e.setAttribute("x",i),e.setAttribute("y",t.height-r-l),a.setAttribute("x",-1),a.setAttribute("y",0);break}}return e}function N(e,t,n){n||(n=JSON.parse(e.getAttribute("data-pdf-annotate-viewport")));let r;switch(t.type){case"area":case"highlight":r=At(t);break;case"strikeout":r=gt(t);break;case"point":r=xt(t);break;case"textbox":r=vt(t);break;case"drawing":r=yt(t);break}return r&&(r.setAttribute("data-pdf-annotate-id",t.uuid),r.setAttribute("data-pdf-annotate-type",t.type),r.setAttribute("aria-hidden",!0),e.appendChild(we(r,n))),r}function J(e,t){let n=document.createElement("div"),r=document.createTextNode(e);return n.appendChild(r),n.setAttribute("id",`pdf-annotate-screenreader-${t}`),n.style.position="absolute",n.style.left="-10000px",n.style.top="auto",n.style.width="1px",n.style.height="1px",n.style.overflow="hidden",n}function se(e,t,n,r,i){t=Math.max(t+2*(i?1:-1),0);let l=St(t,n+2,r);if(!l)return!1;t=t+2*(i?-1:1);let s=document.querySelector(`svg[data-pdf-annotate-page="${r}"]`),a=C(s,{left:l.getBoundingClientRect().left}).left-s.getBoundingClientRect().left,u=l.cloneNode(!0),c=u.innerHTML.split(""),m=[];for(u.style.position="absolute",u.style.top="-10000px",u.style.left="-10000px",document.body.appendChild(u);c.length;){if(c[c.length-1]===">")for(;c.length&&(m.unshift(c.pop()),m[0]!=="<"););u.innerHTML=c.join("");let g=C(s,{width:u.getBoundingClientRect().width}).width;if(a+g<=t)break;m.unshift(c.pop())}return l.innerHTML=c.join("")+e.outerHTML+m.join(""),u.parentNode.removeChild(u),!0}function St(e,t,n){let r=document.querySelector(`svg[data-pdf-annotate-page="${n}"]`),i=r.getBoundingClientRect();return t=I(r,{y:t}).y+i.top,e=I(r,{x:e}).x+i.left,[...r.parentNode.querySelectorAll(".textLayer [data-canvas-width]")].filter(o=>U(e,t,o.getBoundingClientRect()))[0]}function Se(e,t,n,r){if(se(e,t,n,r,!0))return!0;let i=document.querySelector(`svg[data-pdf-annotate-page="${r}"]`),o=i.getBoundingClientRect(),l=[...i.parentNode.querySelectorAll(".textLayer > div")];n=I(i,{y:n}).y+o.top,t=I(i,{x:t}).x+o.left;for(let a=0,u=l.length;a<u;a++){let c=l[a],m=c.getBoundingClientRect();if(n<=m.top)return c.parentNode.insertBefore(e,c),!0}let s=i.parentNode.querySelector(".textLayer");if(s){let a=s.getBoundingClientRect();if(U(t,n,a))return s.appendChild(e),!0}return!1}function Ce(e){if(!e)return;let t=document.querySelector(`#pdf-annotate-screenreader-${e.annotation} ol`);if(t){let n=document.createElement("li");n.setAttribute("id",`pdf-annotate-screenreader-comment-${e.uuid}`),n.appendChild(document.createTextNode(`${e.content}`)),t.appendChild(n)}}function Le(e,t,n){let r;return Array.isArray(n)?r=Promise.resolve(n):r=A.getStoreAdapter().getComments(e,t),r.then(i=>{let o=document.getElementById(`pdf-annotate-screenreader-${t}`);if(o){let l=document.createElement("ol");l.setAttribute("id",`pdf-annotate-screenreader-comment-list-${t}`),l.setAttribute("aria-label","Comments"),o.appendChild(l),i.forEach(Ce)}})}const Ct=["highlight","point","area"];function Lt(e,t=0){switch(e.type){case"highlight":case"strikeout":let n=e.rectangles,r=n[0],i=n[n.length-1];se(J(`Begin ${e.type} annotation ${t}`,e.uuid),r.x,r.y,e.page,!0),se(J(`End ${e.type} annotation ${t}`,`${e.uuid}-end`),i.x+i.width,i.y,e.page,!1);break;case"textbox":case"point":let o=e.type==="textbox"?` (content: ${e.content})`:"";Se(J(`${e.type} annotation ${t}${o}`,e.uuid),e.x,e.y,e.page);break;case"drawing":case"area":let l=typeof e.x<"u"?e.x:e.lines[0][0],s=typeof e.y<"u"?e.y:e.lines[0][1];Se(J("Unlabeled drawing",e.uuid),l,s,e.page);break}Ct.includes(e.type)&&Le(e.documentId,e.uuid)}function $t(){_("annotation:add",(e,t,n)=>{$e(e,t,n.type)}),_("annotation:edit",(e,t,n)=>{$e(e,n.page,n.type)}),_("annotation:delete",ke),_("comment:add",kt),_("comment:delete",It)}function $e(e,t,n){A.getStoreAdapter().getAnnotations(e,t).then(r=>r.annotations.filter(i=>i.type===n)).then(r=>(r.forEach(i=>{ke(e,i.uuid)}),r)).then(Ie)}function ke(e,t){de(`pdf-annotate-screenreader-${t}`),de(`pdf-annotate-screenreader-${t}-end`)}function kt(e,t,n){let r=document.querySelector(`pdf-annotate-screenreader-comment-list-${t}`),i;r?i=Promise.resolve(!0):i=Le(e,t,[]).then(()=>(r=document.querySelector(`pdf-annotate-screenreader-comment-list-${t}`),!0)),i.then(()=>{Ce(n)})}function It(e,t){de(`pdf-annotate-screenreader-comment-${t}`)}function de(e){let t=document.getElementById(e);t&&t.parentNode.removeChild(t)}$t();function Ie(e){e=Array.isArray(e)?e:[],Object.keys(Re).forEach(t=>{let n=Re[t];e.filter(r=>r.type===t).sort(n).forEach((r,i)=>Lt(r,i+1))})}function F(e,t){return e.y<t.y?e.x-t.x:1}function _e(e,t){return F(e.rectangles[0],t.rectangles[0])}function _t(e,t){let n=e.lines[0],r=t.lines[0];return F({x:n[0],y:n[1]},{x:r[0],y:r[1]})}const Re={highlight:_e,strikeout:_e,drawing:_t,textbox:F,point:F,area:F};function Rt(e,t,n){return new Promise((r,i)=>{if(e.innerHTML="",e.setAttribute("data-pdf-annotate-container",!0),e.setAttribute("data-pdf-annotate-viewport",JSON.stringify(t)),e.removeAttribute("data-pdf-annotate-document"),e.removeAttribute("data-pdf-annotate-page"),!n||(e.setAttribute("data-pdf-annotate-document",n.documentId),e.setAttribute("data-pdf-annotate-page",n.pageNumber),!Array.isArray(n.annotations)||n.annotations.length===0))return r(e);n.annotations.forEach(o=>{N(e,o,t)}),r(e)})}let V=!1,K=!1,d,Ne,Pe,Te,Be;const O=3;function Nt(e){Z(),d=document.createElement("div");let t=document.createElement("a"),n=ot(e).parentNode,r=e.getAttribute("data-pdf-annotate-id"),i=ie(e),o=i.left-O,l=i.top-O;d.setAttribute("id","pdf-annotate-edit-overlay"),d.setAttribute("data-target-id",r),d.style.boxSizing="content-box",d.style.position="absolute",d.style.top=`${l}px`,d.style.left=`${o}px`,d.style.width=`${i.width}px`,d.style.height=`${i.height}px`,d.style.border=`${O}px solid ${H}`,d.style.borderRadius=`${O}px`,t.innerHTML="×",t.setAttribute("href","javascript://"),t.style.background="#fff",t.style.borderRadius="20px",t.style.border="1px solid #bbb",t.style.color="#bbb",t.style.fontSize="16px",t.style.padding="2px",t.style.textAlign="center",t.style.textDecoration="none",t.style.position="absolute",t.style.top="-13px",t.style.right="-13px",t.style.width="25px",t.style.height="25px",d.appendChild(t),n.appendChild(d),document.addEventListener("click",qe),document.addEventListener("keyup",Xe),document.addEventListener("mousedown",Ye),t.addEventListener("click",Oe),t.addEventListener("mouseover",()=>{t.style.color="#35A4DC",t.style.borderColor="#999",t.style.boxShadow="0 1px 1px #ccc"}),t.addEventListener("mouseout",()=>{t.style.color="#bbb",t.style.borderColor="#bbb",t.style.boxShadow=""}),d.addEventListener("mouseover",()=>{K||(t.style.display="")}),d.addEventListener("mouseout",()=>{t.style.display="none"})}function Z(){d&&(d.parentNode.removeChild(d),d=null),document.removeEventListener("click",qe),document.removeEventListener("keyup",Xe),document.removeEventListener("mousedown",Ye),document.removeEventListener("mousemove",ue),document.removeEventListener("mouseup",ce),W()}function Oe(){if(!d)return;let e=d.getAttribute("data-target-id"),t=document.querySelectorAll(`[data-pdf-annotate-id="${e}"]`),n=d.parentNode.querySelector("svg.annotationLayer"),{documentId:r}=L(n);[...t].forEach(i=>{i.parentNode.removeChild(i)}),A.getStoreAdapter().deleteAnnotation(r,e),Z()}function qe(e){if(!x(e.clientX,e.clientY))return;let t=document.getElementById("pdf-annotate-edit-overlay");if(t){if(K||e.target===t)return;Z()}}function Xe(e){d&&e.keyCode===46&&e.target.nodeName.toLowerCase()!=="textarea"&&e.target.nodeName.toLowerCase()!=="input"&&Oe()}function Ye(e){if(e.target!==d)return;let t=d.getAttribute("data-target-id"),r=document.querySelector(`[data-pdf-annotate-id="${t}"]`).getAttribute("data-pdf-annotate-type");r==="highlight"||r==="strikeout"||(K=!0,Ne=e.clientX,Pe=e.clientY,Te=d.offsetLeft,Be=d.offsetTop,d.style.background="rgba(255, 255, 255, 0.7)",d.style.cursor="move",d.querySelector("a").style.display="none",document.addEventListener("mousemove",ue),document.addEventListener("mouseup",ce),oe())}function ue(e){d.getAttribute("data-target-id");let n=d.parentNode.getBoundingClientRect(),r=Be+(e.clientY-Pe),i=Te+(e.clientX-Ne),o=0,l=n.height,s=0,a=n.width;r>o&&r+d.offsetHeight<l&&(d.style.top=`${r}px`),i>s&&i+d.offsetWidth<a&&(d.style.left=`${i}px`)}function ce(e){let t=d.getAttribute("data-target-id"),n=document.querySelectorAll(`[data-pdf-annotate-id="${t}"]`),r=n[0].getAttribute("data-pdf-annotate-type"),i=d.parentNode.querySelector("svg.annotationLayer"),{documentId:o}=L(i);d.querySelector("a").style.display="";function l(a,u){return s(parseInt(n[0].getAttribute(a),10),parseInt(n[0].getAttribute(u),10))}function s(a,u){return{deltaX:O+C(i,{x:d.offsetLeft}).x-a,deltaY:O+C(i,{y:d.offsetTop}).y-u}}A.getStoreAdapter().getAnnotation(o,t).then(a=>{if(["area","highlight","point","textbox"].indexOf(r)>-1){let{deltaX:u,deltaY:c}=l("x","y");[...n].forEach((m,g)=>{if(c!==0){let y=parseInt(m.getAttribute("y"),10)+c,v=y;r==="textbox"&&(v+=a.size),r==="point"&&(v=I(i,{viewY:v}).viewY),m.setAttribute("y",v),a.rectangles?a.rectangles[g].y=y:a.y&&(a.y=y)}if(u!==0){let y=parseInt(m.getAttribute("x"),10)+u,v=y;r==="point"&&(v=I(i,{viewX:v}).viewX),m.setAttribute("x",v),a.rectangles?a.rectangles[g].x=y:a.x&&(a.x=y)}})}else if(r==="drawing"){let u=C(i,ie(n[0])),[c,m]=a.lines[0],{deltaX:g,deltaY:y}=s(c,m);y+=m-u.top,g+=c-u.left,a.lines.forEach((v,b)=>{let[T,be]=a.lines[b];a.lines[b][0]=T+g,a.lines[b][1]=be+y}),n[0].parentNode.removeChild(n[0]),N(i,a)}A.getStoreAdapter().editAnnotation(o,t,a)}),setTimeout(()=>{K=!1},0),d.style.background="",d.style.cursor="",document.removeEventListener("mousemove",ue),document.removeEventListener("mouseup",ce),W()}function De(e){Nt(e)}function Pt(){V||(V=!0,_("annotation:click",De))}function Tt(){Z(),V&&(V=!1,Ae("annotation:click",De))}let Q=!1,fe,pe,$,P;function Me(){$=null,P=[],document.addEventListener("mousemove",he),document.addEventListener("mouseup",me)}function me(e){let t;if(P.length>1&&(t=x(e.clientX,e.clientY))){let{documentId:n,pageNumber:r}=L(t);A.getStoreAdapter().addAnnotation(n,r,{type:"drawing",width:fe,color:pe,lines:P}).then(i=>{$&&t.removeChild($),N(t,i)})}document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",me)}function he(e){Bt(e.clientX,e.clientY)}function Fe(e){e.keyCode===27&&(P=null,$.parentNode.removeChild($),document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",me))}function Bt(e,t){let n=x(e,t);if(!n)return;let r=n.getBoundingClientRect(),i=C(n,{x:e-r.left,y:t-r.top});P.push([i.x,i.y]),!(P.length<=1)&&($&&n.removeChild($),$=N(n,{type:"drawing",color:pe,width:fe,lines:P}))}function Ot(e=1,t="000000"){fe=parseInt(e,10),pe=t}function qt(){Q||(Q=!0,document.addEventListener("mousedown",Me),document.addEventListener("keyup",Fe),oe())}function Xt(){Q&&(Q=!1,document.removeEventListener("mousedown",Me),document.removeEventListener("keyup",Fe),W())}let ee=!1,h;function je(e){h||!x(e.clientX,e.clientY)||(h=document.createElement("input"),h.setAttribute("id","pdf-annotate-point-input"),h.setAttribute("placeholder","Enter comment"),h.style.border=`3px solid ${H}`,h.style.borderRadius="3px",h.style.position="absolute",h.style.top=`${e.clientY}px`,h.style.left=`${e.clientX}px`,h.addEventListener("blur",ze),h.addEventListener("keyup",He),document.body.appendChild(h),h.focus())}function ze(){Ue()}function He(e){e.keyCode===27?We():e.keyCode===13&&Ue()}function Ue(){if(h.value.trim().length>0){let e=parseInt(h.style.left,10),t=parseInt(h.style.top,10),n=h.value.trim(),r=x(e,t);if(!r)return;let i=r.getBoundingClientRect(),{documentId:o,pageNumber:l}=L(r),s=Object.assign({type:"point"},C(r,{x:e-i.left,y:t-i.top}));A.getStoreAdapter().addAnnotation(o,l,s).then(a=>{A.getStoreAdapter().addComment(o,a.uuid,n),N(r,a)})}We()}function We(){h.removeEventListener("blur",ze),h.removeEventListener("keyup",He),document.body.removeChild(h),h=null}function Yt(){ee||(ee=!0,document.addEventListener("mouseup",je))}function Dt(){ee&&(ee=!1,document.removeEventListener("mouseup",je))}let te=!1,q,p,j,z;function Mt(){try{let n=window.getSelection().getRangeAt(0).getClientRects();if(n.length>0&&n[0].width>0&&n[0].height>0)return n}catch{}return null}function Ge(e){let t;if(q!=="area"||!(t=x(e.clientX,e.clientY)))return;let n=t.getBoundingClientRect();j=e.clientY,z=e.clientX,p=document.createElement("div"),p.style.position="absolute",p.style.top=`${j-n.top}px`,p.style.left=`${z-n.left}px`,p.style.border=`3px solid ${H}`,p.style.borderRadius="3px",t.parentNode.appendChild(p),document.addEventListener("mousemove",ge),oe()}function ge(e){let n=p.parentNode.querySelector("svg.annotationLayer").getBoundingClientRect();z+(e.clientX-z)<n.right&&(p.style.width=`${e.clientX-z}px`),j+(e.clientY-j)<n.bottom&&(p.style.height=`${e.clientY-j}px`)}function Je(e){let t;if(q!=="area"&&(t=Mt()))x(t[0].left,t[0].top),Ke(q,[...t].map(n=>({top:n.top,left:n.left,width:n.width,height:n.height})));else if(q==="area"&&p){let r=p.parentNode.querySelector("svg.annotationLayer").getBoundingClientRect();Ke(q,[{top:parseInt(p.style.top,10)+r.top,left:parseInt(p.style.left,10)+r.left,width:parseInt(p.style.width,10),height:parseInt(p.style.height,10)}]),p.parentNode.removeChild(p),p=null,document.removeEventListener("mousemove",ge),W()}}function Ve(e){e.keyCode===27&&(window.getSelection().removeAllRanges(),p&&p.parentNode&&(p.parentNode.removeChild(p),p=null,document.removeEventListener("mousemove",ge)))}function Ke(e,t,n){let r=x(t[0].left,t[0].top),i;if(!r)return;let o=r.getBoundingClientRect();if(n||(e==="highlight"?n="FFFF00":e==="strikeout"&&(n="FF0000")),i={type:e,color:n,rectangles:[...t].map(a=>{let u=0;return e==="strikeout"&&(u=a.height/2),C(r,{y:a.top+u-o.top,x:a.left-o.left,width:a.width,height:a.height})}).filter(a=>a.width>0&&a.height>0&&a.x>-1&&a.y>-1)},i.rectangles.length===0)return;if(e==="area"){let a=i.rectangles[0];delete i.rectangles,i.x=a.x,i.y=a.y,i.width=a.width,i.height=a.height}let{documentId:l,pageNumber:s}=L(r);A.getStoreAdapter().addAnnotation(l,s,i).then(a=>{N(r,a)})}function Ft(e){q=e,!te&&(te=!0,document.addEventListener("mouseup",Je),document.addEventListener("mousedown",Ge),document.addEventListener("keyup",Ve))}function jt(){te&&(te=!1,document.removeEventListener("mouseup",Je),document.removeEventListener("mousedown",Ge),document.removeEventListener("keyup",Ve))}let ne=!1,f,ye,Ze;function Qe(e){f||!x(e.clientX,e.clientY)||(f=document.createElement("input"),f.setAttribute("id","pdf-annotate-text-input"),f.setAttribute("placeholder","Enter text"),f.style.border=`3px solid ${H}`,f.style.borderRadius="3px",f.style.position="absolute",f.style.top=`${e.clientY}px`,f.style.left=`${e.clientX}px`,f.style.fontSize=`${ye}px`,f.addEventListener("blur",et),f.addEventListener("keyup",tt),document.body.appendChild(f),f.focus())}function et(){nt()}function tt(e){e.keyCode===27?rt():e.keyCode===13&&nt()}function nt(){if(f.value.trim().length>0){let e=parseInt(f.style.left,10),t=parseInt(f.style.top,10),n=x(e,t);if(!n)return;let{documentId:r,pageNumber:i}=L(n),o=n.getBoundingClientRect(),l=Object.assign({type:"textbox",size:ye,color:Ze,content:f.value.trim()},C(n,{x:e-o.left,y:t-o.top,width:f.offsetWidth,height:f.offsetHeight}));A.getStoreAdapter().addAnnotation(r,i,l).then(s=>{N(n,s)})}rt()}function rt(){f&&(f.removeEventListener("blur",et),f.removeEventListener("keyup",tt),document.body.removeChild(f),f=null)}function zt(e=12,t="000000"){ye=parseInt(e,10),Ze=t}function Ht(){ne||(ne=!0,document.addEventListener("mouseup",Qe))}function Ut(){ne&&(ne=!1,document.removeEventListener("mouseup",Qe))}const Wt=`
  <div style="visibility: hidden;" class="page" data-loaded="false">
    <div class="canvasWrapper">
      <canvas></canvas>
    </div>
    <svg class="annotationLayer"></svg>
    <div class="textLayer"></div>
  </div>
`;function Gt(e){let t=document.createElement("div");t.innerHTML=Wt;let n=t.children[0],r=n.querySelector("canvas");return n.setAttribute("id",`pageContainer${e}`),n.setAttribute("data-page-number",e),r.mozOpaque=!0,r.setAttribute("id",`page${e}`),n}function Jt(e,t){let{documentId:n,pdfDocument:r,scale:i,rotate:o}=t;return Promise.all([r.getPage(e),A.getAnnotations(n,e)]).then(([l,s])=>{let a=document.getElementById(`pageContainer${e}`),u=a.querySelector(".annotationLayer"),m=a.querySelector(".canvasWrapper canvas").getContext("2d",{alpha:!1}),g=l.getViewport(i,o),y=Vt(e,g,m);return Promise.all([l.render({canvasContext:m,viewport:g,transform:y}),A.render(u,g,s)]).then(()=>l.getTextContent({normalizeWhitespace:!0}).then(v=>new Promise((b,T)=>{let be=a.querySelector(".textLayer");import("pdfjs-dist").then(({renderTextLayer:Qt})=>{Qt({textContent:v,container:be,viewport:g,enhanceTextSelection:!0}).promise.then(()=>{try{Ie(s.annotations),b()}catch(en){T(en)}}).catch(T)}).catch(T)}))).then(()=>(a.setAttribute("data-loaded","true"),[l,s]))})}function Vt(e,t,n){let r=document.getElementById(`pageContainer${e}`),i=r.querySelector(".canvasWrapper canvas"),o=r.querySelector(".annotationLayer"),l=r.querySelector(".canvasWrapper"),s=r.querySelector(".textLayer"),a=Kt(n),u=a.scaled?[a.sx,0,0,a.sy,0,0]:null,c=it(a.sx),m=it(a.sy);return r.style.visibility="",i.width=re(t.width*a.sx,c[0]),i.height=re(t.height*a.sy,m[0]),i.style.width=re(t.width,c[1])+"px",i.style.height=re(t.height,c[1])+"px",o.setAttribute("width",t.width),o.setAttribute("height",t.height),o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,r.style.width=`${t.width}px`,r.style.height=`${t.height}px`,l.style.width=`${t.width}px`,l.style.height=`${t.height}px`,s.style.width=`${t.width}px`,s.style.height=`${t.height}px`,u}function it(e){if(Math.floor(e)===e)return[e,1];const t=1/e,n=8;if(t>n)return[1,n];if(Math.floor(t)===t)return[1,t];const r=e>1?t:e;let i=0,o=1,l=1,s=1;for(;;){let a=i+l,u=o+s;if(u>n)break;r<=a/u?(l=a,s=u):(i=a,o=u)}return r-i/o<l/s-r?r===e?[i,o]:[o,i]:r===e?[l,s]:[s,l]}function Kt(e){let t=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,r=t/n;return{sx:r,sy:r,scaled:r!==1}}function re(e,t){let n=e%t;return n===0?e:Math.round(e-n+t)}const Zt={addEventListener:_,removeEventListener:Ae,fireEvent:B,disableEdit:Tt,enableEdit:Pt,disablePen:Xt,enablePen:qt,setPen:Ot,disablePoint:Dt,enablePoint:Yt,disableRect:jt,enableRect:Ft,disableText:Ut,enableText:Ht,setText:zt,createPage:Gt,renderPage:Jt},A={StoreAdapter:le,LocalStoreAdapter:ct,__storeAdapter:new le,getStoreAdapter(){return this.__storeAdapter},setStoreAdapter(e){this.__storeAdapter=e},UI:Zt,render:Rt,getAnnotations(e,t){return this.getStoreAdapter().getAnnotations(...arguments)}};return A});
//# sourceMappingURL=pdf-annotate.min.js.map
